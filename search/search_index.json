{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"langchain-cockroachdb","text":"<p>LangChain integration for CockroachDB with native vector support</p> <p> </p>"},{"location":"#overview","title":"Overview","text":"<p>This package provides LangChain abstractions backed by CockroachDB, leveraging CockroachDB's native <code>VECTOR</code> type and C-SPANN (CockroachDB SPANN) indexes for vector search at scale in a distributed, horizontally scalable database.</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#vector-store","title":"\ud83c\udfaf Vector Store","text":"<ul> <li>Native Vector Support: Uses CockroachDB's native <code>VECTOR</code> type (not pgvector)</li> <li>C-SPANN Indexes: CockroachDB's vector index algorithm optimized for distributed systems</li> <li>Advanced Filtering: Rich metadata filtering with <code>$and/$or/$gt/$in</code> operators</li> <li>Hybrid Search: Combine full-text search (TSVECTOR) with vector similarity</li> <li>Query-Time Tuning: Adjust beam size for accuracy/speed tradeoff</li> </ul>"},{"location":"#reliability-features","title":"\ud83c\udfd7\ufe0f Reliability Features","text":"<ul> <li>Automatic Retry Logic: Handles 40001 serialization errors with exponential backoff</li> <li>SERIALIZABLE Isolation: Built for CockroachDB's default isolation level</li> <li>Multi-Tenancy: Index prefix columns for efficient tenant isolation</li> <li>Connection Pooling: Configurable connection pools with health checks</li> <li>Horizontal Scalability: Designed for distributed deployments</li> </ul>"},{"location":"#chat-history","title":"\ud83d\udcac Chat History","text":"<ul> <li>Persistent Storage: Store conversation history in CockroachDB</li> <li>Session Management: Organize by session/thread ID</li> <li>LangChain Integration: Drop-in replacement for other chat history implementations</li> </ul>"},{"location":"#async-sync-apis","title":"\ud83d\udd04 Async &amp; Sync APIs","text":"<ul> <li>Async-First: High-performance async operations for I/O concurrency</li> <li>Sync Wrapper: Simple synchronous API for scripts and batch jobs</li> <li>Connection Pooling: Efficient connection reuse across async operations</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>import asyncio\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\nfrom langchain_openai import OpenAIEmbeddings\n\nasync def main():\n    # Initialize engine\n    engine = CockroachDBEngine.from_connection_string(\n        \"cockroachdb://user:pass@host:26257/db?sslmode=verify-full\"\n    )\n\n    # Create table\n    await engine.ainit_vectorstore_table(\n        table_name=\"documents\",\n        vector_dimension=1536,\n    )\n\n    # Initialize vector store\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=OpenAIEmbeddings(),\n        collection_name=\"documents\",\n    )\n\n    # Add documents\n    await vectorstore.aadd_texts([\n        \"CockroachDB is a distributed SQL database\",\n        \"LangChain makes it easy to build LLM applications\",\n    ])\n\n    # Search\n    results = await vectorstore.asimilarity_search(\n        \"Tell me about databases\",\n        k=2\n    )\n\n    print(results)\n    await engine.aclose()\n\nasyncio.run(main())\n</code></pre>"},{"location":"#why-cockroachdb","title":"Why CockroachDB?","text":"<ul> <li>Distributed by Design: Scale horizontally across regions</li> <li>Native Vector Support: First-class <code>VECTOR</code> type and C-SPANN indexes</li> <li>SERIALIZABLE: Strong consistency without sacrificing performance</li> <li>Cloud Native: Deploy anywhere (AWS, GCP, Azure, on-prem)</li> <li>PostgreSQL Compatible: Familiar SQL with distributed superpowers</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<p>Choose your path:</p> <ul> <li> <p> Quick Start</p> <p>Get up and running in 5 minutes</p> <p> Quick Start</p> </li> <li> <p> Guides</p> <p>Learn key concepts and patterns</p> <p> Guides</p> </li> <li> <p> API Reference</p> <p>Detailed API documentation</p> <p> API Docs</p> </li> <li> <p> Examples</p> <p>Working code examples</p> <p> Examples</p> </li> </ul>"},{"location":"#community-support","title":"Community &amp; Support","text":"<ul> <li>GitHub: cockroachdb/langchain-cockroachdb</li> <li>Issues: Report bugs or request features</li> <li>Discussions: Ask questions</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions welcome! This is an open-source project built for the community.</p> <p> Contributing Guide</p>"},{"location":"#license","title":"License","text":"<p>Apache License 2.0 - see LICENSE for details.</p> <p>Built with \u2764\ufe0f for the CockroachDB and LangChain communities</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to langchain-cockroachdb will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"about/changelog/#unreleased","title":"Unreleased","text":""},{"location":"about/changelog/#010-2024-01-31","title":"0.1.0 - 2024-01-31","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Initial release of langchain-cockroachdb</li> <li><code>CockroachDBEngine</code> for connection management</li> <li><code>AsyncCockroachDBVectorStore</code> for async vector operations</li> <li><code>CockroachDBVectorStore</code> sync wrapper</li> <li><code>CSPANNIndex</code> for C-SPANN vector indexes</li> <li><code>HybridSearchConfig</code> for FTS + vector search</li> <li><code>CockroachDBChatMessageHistory</code> for chat persistence</li> <li>Automatic retry logic with exponential backoff</li> <li>Comprehensive test suite (92 tests)</li> <li>Full documentation with mkdocs</li> <li>7 working examples</li> <li>Support for Python 3.10-3.12</li> </ul>"},{"location":"about/changelog/#features","title":"Features","text":"<ul> <li>Native CockroachDB VECTOR type support</li> <li>C-SPANN distributed vector indexes</li> <li>Advanced metadata filtering</li> <li>Connection pooling with health checks</li> <li>Configurable retry parameters</li> <li>Both async and sync APIs</li> <li>Multi-tenant index support</li> </ul>"},{"location":"about/license/","title":"License","text":"<p>langchain-cockroachdb is licensed under the Apache License 2.0.</p>"},{"location":"about/license/#apache-license-20","title":"Apache License 2.0","text":"<p>Copyright 2026 Virag Tripathi</p> <p>Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> <pre><code>http://www.apache.org/licenses/LICENSE-2.0\n</code></pre> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>"},{"location":"about/license/#full-license-text","title":"Full License Text","text":"<p>The full license text is available at: https://github.com/cockroachdb/langchain-cockroachdb/blob/main/LICENSE</p>"},{"location":"about/license/#third-party-licenses","title":"Third-Party Licenses","text":"<p>This project uses the following open-source packages:</p> <ul> <li>LangChain: MIT License</li> <li>SQLAlchemy: MIT License</li> <li>CockroachDB Python Driver: Apache License 2.0</li> <li>Psycopg3: LGPL License</li> </ul> <p>See their respective repositories for full license texts.</p>"},{"location":"api/chat-history/","title":"Chat History API","text":"<p>Persistent conversation storage.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory","title":"<code>langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory</code>","text":"<p>               Bases: <code>BaseChatMessageHistory</code></p> <p>Chat message history stored in CockroachDB.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.messages","title":"<code>messages</code>  <code>property</code>","text":"<p>Get all messages for this session.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.__del__","title":"<code>__del__()</code>","text":"<p>Cleanup on deletion.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.__init__","title":"<code>__init__(session_id, connection_string=None, engine=None, table_name='message_store', schema='public')</code>","text":"<p>Initialize chat message history.</p> <p>Parameters:</p> Name Type Description Default <code>session_id</code> <code>str</code> <p>Unique session/thread identifier</p> required <code>connection_string</code> <code>str | None</code> <p>Database connection string</p> <code>None</code> <code>engine</code> <code>AsyncEngine | None</code> <p>Existing async engine</p> <code>None</code> <code>table_name</code> <code>str</code> <p>Table name for messages</p> <code>'message_store'</code> <code>schema</code> <code>str</code> <p>Database schema</p> <code>'public'</code>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.aadd_message","title":"<code>aadd_message(message)</code>  <code>async</code>","text":"<p>Add a message (async).</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.aadd_messages","title":"<code>aadd_messages(messages)</code>  <code>async</code>","text":"<p>Add multiple messages (async).</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.aclear","title":"<code>aclear()</code>  <code>async</code>","text":"<p>Clear messages (async).</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.aclose","title":"<code>aclose()</code>  <code>async</code>","text":"<p>Close engine if we own it.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.add_message","title":"<code>add_message(message)</code>","text":"<p>Add a message to the session.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.add_messages","title":"<code>add_messages(messages)</code>","text":"<p>Add multiple messages.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.aget_messages","title":"<code>aget_messages()</code>  <code>async</code>","text":"<p>Get all messages for this session (async).</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.clear","title":"<code>clear()</code>","text":"<p>Clear all messages for this session.</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.close","title":"<code>close()</code>","text":"<p>Close engine (sync).</p>"},{"location":"api/chat-history/#langchain_cockroachdb.chat_message_histories.CockroachDBChatMessageHistory.create_table_if_not_exists","title":"<code>create_table_if_not_exists()</code>","text":"<p>Create table (sync wrapper).</p>"},{"location":"api/chat-history/#key-methods","title":"Key Methods","text":"Method Description <code>add_user_message()</code> Add user message <code>add_ai_message()</code> Add AI response <code>add_message()</code> Add any message type <code>clear()</code> Clear session history <code>messages</code> Get all messages"},{"location":"api/chat-history/#examples","title":"Examples","text":"<p>See Chat History Guide for comprehensive examples.</p>"},{"location":"api/engine/","title":"CockroachDBEngine API","text":"<p>Connection and transaction management.</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine","title":"<code>langchain_cockroachdb.engine.CockroachDBEngine</code>","text":"<p>Manages async SQLAlchemy engine for CockroachDB with retry support.</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.from_connection_string","title":"<code>from_connection_string(connection_string, *, pool_size=10, max_overflow=20, pool_pre_ping=True, pool_recycle=3600, pool_timeout=30.0, retry_max_attempts=5, retry_initial_backoff=0.1, retry_max_backoff=10.0, retry_backoff_multiplier=2.0, retry_jitter=True, **kwargs)</code>  <code>classmethod</code>","text":"<p>Create engine from connection string.</p> <p>Parameters:</p> Name Type Description Default <code>connection_string</code> <code>str</code> <p>CockroachDB connection URL</p> required <code>pool_size</code> <code>int</code> <p>Connection pool size (default: 10)</p> <code>10</code> <code>max_overflow</code> <code>int</code> <p>Max connections beyond pool_size (default: 20)</p> <code>20</code> <code>pool_pre_ping</code> <code>bool</code> <p>Enable connection health checks (default: True)</p> <code>True</code> <code>pool_recycle</code> <code>int</code> <p>Recycle connections after N seconds (default: 3600)</p> <code>3600</code> <code>pool_timeout</code> <code>float</code> <p>Connection timeout in seconds (default: 30.0)</p> <code>30.0</code> <code>retry_max_attempts</code> <code>int</code> <p>Maximum retry attempts (default: 5)</p> <code>5</code> <code>retry_initial_backoff</code> <code>float</code> <p>Initial backoff delay in seconds (default: 0.1)</p> <code>0.1</code> <code>retry_max_backoff</code> <code>float</code> <p>Maximum backoff delay in seconds (default: 10.0)</p> <code>10.0</code> <code>retry_backoff_multiplier</code> <code>float</code> <p>Backoff multiplier (default: 2.0)</p> <code>2.0</code> <code>retry_jitter</code> <code>bool</code> <p>Add randomization to backoff (default: True)</p> <code>True</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments for create_async_engine</p> <code>{}</code> <p>Returns:</p> Type Description <code>CockroachDBEngine</code> <p>CockroachDBEngine instance</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.from_engine","title":"<code>from_engine(engine)</code>  <code>classmethod</code>","text":"<p>Create from existing AsyncEngine.</p> <p>Parameters:</p> Name Type Description Default <code>engine</code> <code>AsyncEngine</code> <p>SQLAlchemy AsyncEngine</p> required <p>Returns:</p> Type Description <code>CockroachDBEngine</code> <p>CockroachDBEngine instance</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.ainit_vectorstore_table","title":"<code>ainit_vectorstore_table(table_name, vector_dimension, *, schema='public', id_type='UUID', content_column='content', embedding_column='embedding', metadata_column='metadata', create_tsvector=False, drop_if_exists=False)</code>  <code>async</code>","text":"<p>Create vector store table with optional full-text search.</p> <p>Uses retry logic configured on engine instance.</p> <p>Parameters:</p> Name Type Description Default <code>table_name</code> <code>str</code> <p>Name of the table to create</p> required <code>vector_dimension</code> <code>int</code> <p>Dimension of vector embeddings</p> required <code>schema</code> <code>str</code> <p>Database schema (default: public)</p> <code>'public'</code> <code>id_type</code> <code>str</code> <p>Type for ID column (default: UUID)</p> <code>'UUID'</code> <code>content_column</code> <code>str</code> <p>Name of content column</p> <code>'content'</code> <code>embedding_column</code> <code>str</code> <p>Name of embedding column</p> <code>'embedding'</code> <code>metadata_column</code> <code>str</code> <p>Name of metadata column</p> <code>'metadata'</code> <code>create_tsvector</code> <code>bool</code> <p>Create TSVECTOR column for FTS</p> <code>False</code> <code>drop_if_exists</code> <code>bool</code> <p>Drop table if it exists</p> <code>False</code>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.init_vectorstore_table","title":"<code>init_vectorstore_table(table_name, vector_dimension, **kwargs)</code>","text":"<p>Sync wrapper for ainit_vectorstore_table.</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.aclose","title":"<code>aclose()</code>  <code>async</code>","text":"<p>Close async engine.</p>"},{"location":"api/engine/#langchain_cockroachdb.engine.CockroachDBEngine.close","title":"<code>close()</code>","text":"<p>Sync wrapper for aclose.</p>"},{"location":"api/engine/#overview","title":"Overview","text":"<p>The <code>CockroachDBEngine</code> manages database connections, connection pooling, and table initialization.</p>"},{"location":"api/engine/#class-methods","title":"Class Methods","text":""},{"location":"api/engine/#from_connection_string","title":"from_connection_string","text":"<p>Create engine from connection string.</p> <pre><code>engine = CockroachDBEngine.from_connection_string(\n    \"cockroachdb://user:pass@host:26257/db\",\n    pool_size=10,\n    max_overflow=20,\n)\n</code></pre>"},{"location":"api/engine/#from_engine","title":"from_engine","text":"<p>Create from existing SQLAlchemy engine.</p> <pre><code>from sqlalchemy.ext.asyncio import create_async_engine\n\nasync_engine = create_async_engine(\"cockroachdb://...\")\nengine = CockroachDBEngine.from_engine(async_engine)\n</code></pre>"},{"location":"api/engine/#instance-methods","title":"Instance Methods","text":""},{"location":"api/engine/#ainit_vectorstore_table","title":"ainit_vectorstore_table","text":"<p>Create vector store table (async).</p> <pre><code>await engine.ainit_vectorstore_table(\n    table_name=\"documents\",\n    vector_dimension=1536,\n    drop_if_exists=False,\n)\n</code></pre>"},{"location":"api/engine/#init_vectorstore_table","title":"init_vectorstore_table","text":"<p>Create vector store table (sync).</p> <pre><code>engine.init_vectorstore_table(\n    table_name=\"documents\",\n    vector_dimension=1536,\n)\n</code></pre>"},{"location":"api/engine/#aclose-close","title":"aclose / close","text":"<p>Close engine and connections.</p> <pre><code>await engine.aclose()  # Async\nengine.close()          # Sync\n</code></pre>"},{"location":"api/engine/#configuration-parameters","title":"Configuration Parameters","text":"Parameter Type Default Description <code>pool_size</code> int 10 Base connection pool size <code>max_overflow</code> int 20 Additional connections allowed <code>pool_pre_ping</code> bool True Health check before use <code>pool_recycle</code> int 3600 Recycle connections after (seconds) <code>pool_timeout</code> float 30.0 Wait timeout for connection <code>retry_max_attempts</code> int 5 Maximum retry attempts <code>retry_initial_backoff</code> float 0.1 Initial retry delay <code>retry_max_backoff</code> float 10.0 Maximum retry delay <code>retry_backoff_multiplier</code> float 2.0 Backoff multiplier <code>retry_jitter</code> bool True Add randomization to backoff"},{"location":"api/engine/#examples","title":"Examples","text":"<p>See Configuration Guide for detailed examples.</p>"},{"location":"api/indexes/","title":"Indexes API","text":"<p>C-SPANN index configuration.</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.CSPANNIndex","title":"<code>langchain_cockroachdb.indexes.CSPANNIndex</code>","text":"<p>CockroachDB C-SPANN vector index configuration.</p> <p>C-SPANN (CockroachDB SPANN) is CockroachDB's vector indexing algorithm for real-time indexing of billions of vectors in distributed systems. Based on Microsoft's SPANN (Space Partition with Approximate Nearest Neighbor).</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.CSPANNIndex.__init__","title":"<code>__init__(distance_strategy=DistanceStrategy.COSINE, min_partition_size=None, max_partition_size=None, name=None)</code>","text":"<p>Initialize C-SPANN index configuration.</p> <p>Parameters:</p> Name Type Description Default <code>distance_strategy</code> <code>DistanceStrategy</code> <p>Distance metric to use</p> <code>COSINE</code> <code>min_partition_size</code> <code>int | None</code> <p>Minimum partition size for C-SPANN</p> <code>None</code> <code>max_partition_size</code> <code>int | None</code> <p>Maximum partition size for C-SPANN</p> <code>None</code> <code>name</code> <code>str | None</code> <p>Optional custom index name</p> <code>None</code>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.CSPANNIndex.get_create_index_sql","title":"<code>get_create_index_sql(table_name, column_name, *, schema='public', prefix_columns=None)</code>","text":"<p>Generate CREATE VECTOR INDEX SQL.</p> <p>Parameters:</p> Name Type Description Default <code>table_name</code> <code>str</code> <p>Target table name</p> required <code>column_name</code> <code>str</code> <p>Vector column name</p> required <code>schema</code> <code>str</code> <p>Database schema</p> <code>'public'</code> <code>prefix_columns</code> <code>list[str] | None</code> <p>Optional prefix columns for multi-tenant indexes</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>SQL statement to create the index</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.CSPANNIndex.get_drop_index_sql","title":"<code>get_drop_index_sql(table_name, column_name, *, schema='public')</code>","text":"<p>Generate DROP INDEX SQL.</p> <p>Parameters:</p> Name Type Description Default <code>table_name</code> <code>str</code> <p>Target table name</p> required <code>column_name</code> <code>str</code> <p>Vector column name</p> required <code>schema</code> <code>str</code> <p>Database schema</p> <code>'public'</code> <p>Returns:</p> Type Description <code>str</code> <p>SQL statement to drop the index</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.DistanceStrategy","title":"<code>langchain_cockroachdb.indexes.DistanceStrategy</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Distance strategies for vector similarity.</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.DistanceStrategy.get_opclass","title":"<code>get_opclass()</code>","text":"<p>Get index operator class.</p>"},{"location":"api/indexes/#langchain_cockroachdb.indexes.DistanceStrategy.get_operator","title":"<code>get_operator()</code>","text":"<p>Get SQL operator for distance calculation.</p>"},{"location":"api/indexes/#distance-strategies","title":"Distance Strategies","text":"Strategy Operator Best For <code>COSINE</code> <code>&lt;=&gt;</code> Normalized vectors (most embeddings) <code>EUCLIDEAN</code> <code>&lt;-&gt;</code> Spatial data, L2 distance <code>INNER_PRODUCT</code> <code>&lt;#&gt;</code> Pre-normalized vectors"},{"location":"api/indexes/#examples","title":"Examples","text":"<p>See Vector Indexes Guide for complete examples.</p>"},{"location":"api/vectorstore/","title":"Vector Store API","text":"<p>Complete API reference for AsyncCockroachDBVectorStore and CockroachDBVectorStore.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore","title":"<code>langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore</code>","text":"<p>               Bases: <code>VectorStore</code></p> <p>Async vector store using CockroachDB native VECTOR type and C-SPANN indexes.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.embeddings","title":"<code>embeddings</code>  <code>property</code>","text":"<p>Get embeddings model.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.__init__","title":"<code>__init__(engine, embeddings, collection_name, *, schema='public', distance_strategy=DistanceStrategy.COSINE, content_column='content', embedding_column='embedding', metadata_column='metadata', id_column='id', hybrid_search_config=None, batch_size=100, retry_max_attempts=3, retry_initial_backoff=0.1, retry_max_backoff=5.0, retry_backoff_multiplier=2.0, retry_jitter=True)</code>","text":"<p>Initialize async vector store.</p> <p>Parameters:</p> Name Type Description Default <code>engine</code> <code>CockroachDBEngine</code> <p>CockroachDBEngine instance</p> required <code>embeddings</code> <code>Embeddings</code> <p>Embeddings model</p> required <code>collection_name</code> <code>str</code> <p>Table name for this collection</p> required <code>schema</code> <code>str</code> <p>Database schema (default: public)</p> <code>'public'</code> <code>distance_strategy</code> <code>DistanceStrategy</code> <p>Distance metric for similarity (default: COSINE)</p> <code>COSINE</code> <code>content_column</code> <code>str</code> <p>Name of content column (default: content)</p> <code>'content'</code> <code>embedding_column</code> <code>str</code> <p>Name of embedding column (default: embedding)</p> <code>'embedding'</code> <code>metadata_column</code> <code>str</code> <p>Name of metadata column (default: metadata)</p> <code>'metadata'</code> <code>id_column</code> <code>str</code> <p>Name of ID column (default: id)</p> <code>'id'</code> <code>hybrid_search_config</code> <code>HybridSearchConfig | None</code> <p>Optional hybrid search configuration</p> <code>None</code> <code>batch_size</code> <code>int</code> <p>Batch size for inserts - CockroachDB works best with smaller batches (default: 100)</p> <code>100</code> <code>retry_max_attempts</code> <code>int</code> <p>Maximum retry attempts for operations (default: 3)</p> <code>3</code> <code>retry_initial_backoff</code> <code>float</code> <p>Initial backoff delay in seconds (default: 0.1)</p> <code>0.1</code> <code>retry_max_backoff</code> <code>float</code> <p>Maximum backoff delay in seconds (default: 5.0)</p> <code>5.0</code> <code>retry_backoff_multiplier</code> <code>float</code> <p>Backoff multiplier (default: 2.0)</p> <code>2.0</code> <code>retry_jitter</code> <code>bool</code> <p>Add randomization to backoff (default: True)</p> <code>True</code>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.aadd_texts","title":"<code>aadd_texts(texts, metadatas=None, ids=None, **kwargs)</code>  <code>async</code>","text":"<p>Add texts to vector store with automatic retry on failures.</p> <p>Parameters:</p> Name Type Description Default <code>texts</code> <code>Iterable[str]</code> <p>Texts to add</p> required <code>metadatas</code> <code>list[dict] | None</code> <p>Optional metadata for each text</p> <code>None</code> <code>ids</code> <code>list[str] | None</code> <p>Optional IDs for texts</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments (batch_size override supported)</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of IDs for added texts</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.aapply_vector_index","title":"<code>aapply_vector_index(index, prefix_columns=None)</code>  <code>async</code>","text":"<p>Apply C-SPANN vector index.</p> <p>Parameters:</p> Name Type Description Default <code>index</code> <code>CSPANNIndex</code> <p>Index configuration</p> required <code>prefix_columns</code> <code>list[str] | None</code> <p>Optional prefix columns for multi-tenant indexes</p> <code>None</code>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.add_texts","title":"<code>add_texts(texts, metadatas=None, **kwargs)</code>","text":"<p>Sync wrapper - not implemented for async-only store.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.adelete","title":"<code>adelete(ids=None, **kwargs)</code>  <code>async</code>","text":"<p>Delete documents by IDs.</p> <p>Parameters:</p> Name Type Description Default <code>ids</code> <code>list[str] | None</code> <p>Document IDs to delete</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>bool | None</code> <p>True if successful</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.adrop_vector_index","title":"<code>adrop_vector_index(index)</code>  <code>async</code>","text":"<p>Drop vector index.</p> <p>Parameters:</p> Name Type Description Default <code>index</code> <code>CSPANNIndex</code> <p>Index configuration</p> required"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.afrom_texts","title":"<code>afrom_texts(texts, embedding, metadatas=None, engine=None, connection_string=None, collection_name='langchain_vectors', **kwargs)</code>  <code>async</code> <code>classmethod</code>","text":"<p>Create vector store from texts.</p> <p>Parameters:</p> Name Type Description Default <code>texts</code> <code>list[str]</code> <p>Texts to add</p> required <code>embedding</code> <code>Embeddings</code> <p>Embeddings model</p> required <code>metadatas</code> <code>list[dict] | None</code> <p>Optional metadata</p> <code>None</code> <code>engine</code> <code>CockroachDBEngine | None</code> <p>CockroachDBEngine instance</p> <code>None</code> <code>connection_string</code> <code>str | None</code> <p>Connection string (if engine not provided)</p> <code>None</code> <code>collection_name</code> <code>str</code> <p>Table name</p> <code>'langchain_vectors'</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>AsyncCockroachDBVectorStore</code> <p>AsyncCockroachDBVectorStore instance</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.amax_marginal_relevance_search","title":"<code>amax_marginal_relevance_search(query, k=4, fetch_k=20, lambda_mult=0.5, filter=None, **kwargs)</code>  <code>async</code>","text":"<p>Max marginal relevance search.</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>fetch_k</code> <code>int</code> <p>Number of candidates to fetch</p> <code>20</code> <code>lambda_mult</code> <code>float</code> <p>Diversity parameter (0=max diversity, 1=max relevance)</p> <code>0.5</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.asimilarity_search","title":"<code>asimilarity_search(query, k=4, filter=None, **kwargs)</code>  <code>async</code>","text":"<p>Search for similar documents.</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.asimilarity_search_with_score","title":"<code>asimilarity_search_with_score(query, k=4, filter=None, query_options=None, **kwargs)</code>  <code>async</code>","text":"<p>Search for similar documents with scores.</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>query_options</code> <code>CSPANNQueryOptions | None</code> <p>C-SPANN query options</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[tuple[Document, float]]</code> <p>List of (document, score) tuples</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.asimilarity_search_with_score_by_vector","title":"<code>asimilarity_search_with_score_by_vector(embedding, k=4, filter=None, query_options=None, **kwargs)</code>  <code>async</code>","text":"<p>Search for similar documents by embedding vector.</p> <p>Parameters:</p> Name Type Description Default <code>embedding</code> <code>list[float]</code> <p>Query embedding vector</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>query_options</code> <code>CSPANNQueryOptions | None</code> <p>C-SPANN query options</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[tuple[Document, float]]</code> <p>List of (document, score) tuples</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.from_texts","title":"<code>from_texts(texts, embedding, metadatas=None, **kwargs)</code>  <code>classmethod</code>","text":"<p>Sync wrapper - not implemented for async-only store.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.async_vectorstore.AsyncCockroachDBVectorStore.similarity_search","title":"<code>similarity_search(query, k=4, **kwargs)</code>","text":"<p>Sync wrapper - not implemented for async-only store.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore","title":"<code>langchain_cockroachdb.vectorstores.CockroachDBVectorStore</code>","text":"<p>               Bases: <code>AsyncCockroachDBVectorStore</code></p> <p>Sync wrapper for AsyncCockroachDBVectorStore using background event loop.</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.add_texts","title":"<code>add_texts(texts, metadatas=None, ids=None, **kwargs)</code>","text":"<p>Add texts to vector store (sync).</p> <p>Parameters:</p> Name Type Description Default <code>texts</code> <code>Iterable[str]</code> <p>Texts to add</p> required <code>metadatas</code> <code>list[dict] | None</code> <p>Optional metadata</p> <code>None</code> <code>ids</code> <code>list[str] | None</code> <p>Optional IDs</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[str]</code> <p>List of IDs</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.apply_vector_index","title":"<code>apply_vector_index(index, **kwargs)</code>","text":"<p>Apply vector index to the table (sync).</p> <p>Parameters:</p> Name Type Description Default <code>index</code> <code>Any</code> <p>Index configuration</p> required <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.delete","title":"<code>delete(ids=None, **kwargs)</code>","text":"<p>Delete documents (sync).</p> <p>Parameters:</p> Name Type Description Default <code>ids</code> <code>list[str] | None</code> <p>Document IDs</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>bool | None</code> <p>True if successful</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.from_texts","title":"<code>from_texts(texts, embedding, metadatas=None, engine=None, connection_string=None, collection_name='langchain_vectors', **kwargs)</code>  <code>classmethod</code>","text":"<p>Create from texts (sync).</p> <p>Parameters:</p> Name Type Description Default <code>texts</code> <code>list[str]</code> <p>Texts to add</p> required <code>embedding</code> <code>Embeddings</code> <p>Embeddings model</p> required <code>metadatas</code> <code>list[dict] | None</code> <p>Optional metadata</p> <code>None</code> <code>engine</code> <code>CockroachDBEngine | None</code> <p>CockroachDBEngine instance</p> <code>None</code> <code>connection_string</code> <code>str | None</code> <p>Connection string</p> <code>None</code> <code>collection_name</code> <code>str</code> <p>Table name</p> <code>'langchain_vectors'</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>CockroachDBVectorStore</code> <p>CockroachDBVectorStore instance</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.max_marginal_relevance_search","title":"<code>max_marginal_relevance_search(query, k=4, fetch_k=20, lambda_mult=0.5, filter=None, **kwargs)</code>","text":"<p>MMR search (sync).</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>fetch_k</code> <code>int</code> <p>Candidate pool size</p> <code>20</code> <code>lambda_mult</code> <code>float</code> <p>Diversity parameter</p> <code>0.5</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.similarity_search","title":"<code>similarity_search(query, k=4, filter=None, **kwargs)</code>","text":"<p>Search for similar documents (sync).</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents</p>"},{"location":"api/vectorstore/#langchain_cockroachdb.vectorstores.CockroachDBVectorStore.similarity_search_with_score","title":"<code>similarity_search_with_score(query, k=4, filter=None, query_options=None, **kwargs)</code>","text":"<p>Search with scores (sync).</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>Query text</p> required <code>k</code> <code>int</code> <p>Number of results</p> <code>4</code> <code>filter</code> <code>dict | None</code> <p>Metadata filter</p> <code>None</code> <code>query_options</code> <code>CSPANNQueryOptions | None</code> <p>Query options</p> <code>None</code> <code>**kwargs</code> <code>Any</code> <p>Additional arguments</p> <code>{}</code> <p>Returns:</p> Type Description <code>list[tuple[Document, float]]</code> <p>List of (document, score) tuples</p>"},{"location":"api/vectorstore/#key-methods","title":"Key Methods","text":""},{"location":"api/vectorstore/#adding-documents","title":"Adding Documents","text":"Method Async Description <code>aadd_texts()</code> \u2713 Add text documents <code>add_texts()</code> - Sync wrapper <code>aadd_documents()</code> \u2713 Add Document objects <code>add_documents()</code> - Sync wrapper"},{"location":"api/vectorstore/#searching","title":"Searching","text":"Method Async Description <code>asimilarity_search()</code> \u2713 Search by text <code>similarity_search()</code> - Sync wrapper <code>asimilarity_search_with_score()</code> \u2713 Search with scores <code>asimilarity_search_by_vector()</code> \u2713 Search by vector <code>amax_marginal_relevance_search()</code> \u2713 MMR search"},{"location":"api/vectorstore/#index-management","title":"Index Management","text":"Method Async Description <code>aapply_vector_index()</code> \u2713 Create C-SPANN index <code>apply_vector_index()</code> - Sync wrapper <code>adrop_vector_index()</code> \u2713 Drop index <code>drop_vector_index()</code> - Sync wrapper"},{"location":"api/vectorstore/#deleting","title":"Deleting","text":"Method Async Description <code>adelete()</code> \u2713 Delete documents <code>delete()</code> - Sync wrapper"},{"location":"api/vectorstore/#examples","title":"Examples","text":"<p>See Vector Store Guide for comprehensive examples.</p>"},{"location":"development/architecture/","title":"Architecture","text":"<p>Understanding the internal structure of langchain-cockroachdb.</p>"},{"location":"development/architecture/#package-structure","title":"Package Structure","text":"<pre><code>langchain_cockroachdb/\n\u251c\u2500\u2500 __init__.py              # Public API exports\n\u251c\u2500\u2500 engine.py                # Connection management\n\u251c\u2500\u2500 async_vectorstore.py     # Async vector store implementation\n\u251c\u2500\u2500 vectorstores.py          # Sync wrapper\n\u251c\u2500\u2500 indexes.py               # Index abstractions\n\u251c\u2500\u2500 hybrid_search_config.py  # Hybrid search configuration\n\u251c\u2500\u2500 chat_message_histories.py # Chat persistence\n\u2514\u2500\u2500 retry.py                 # Retry logic\n</code></pre>"},{"location":"development/architecture/#core-components","title":"Core Components","text":""},{"location":"development/architecture/#cockroachdbengine","title":"CockroachDBEngine","text":"<p>Purpose: Connection and transaction management</p> <p>Key Features: - AsyncEngine from SQLAlchemy - Connection pooling - Retry configuration - Table initialization</p> <p>Pattern: <pre><code>engine = CockroachDBEngine.from_connection_string(url)\n# Engine manages connection lifecycle\nawait engine.aclose()\n</code></pre></p>"},{"location":"development/architecture/#asynccockroachdbvectorstore","title":"AsyncCockroachDBVectorStore","text":"<p>Purpose: Primary vector store implementation</p> <p>Key Features: - Async-first design - Batch operations - Metadata filtering - Index management</p> <p>Pattern: <pre><code>vectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n)\nawait vectorstore.aadd_texts(texts)\n</code></pre></p>"},{"location":"development/architecture/#cockroachdbvectorstore","title":"CockroachDBVectorStore","text":"<p>Purpose: Synchronous wrapper for async operations</p> <p>Implementation: - Runs async methods in background event loop - Same API as async version (without <code>a</code> prefix) - Uses <code>asyncio.run()</code> internally</p> <p>Pattern: <pre><code>vectorstore = CockroachDBVectorStore(...)  # Sync\nvectorstore.add_texts(texts)  # No await\n</code></pre></p>"},{"location":"development/architecture/#design-patterns","title":"Design Patterns","text":""},{"location":"development/architecture/#async-first-architecture","title":"Async-First Architecture","text":"<p>All I/O operations are async by default:</p> <pre><code># Core operations\nasync def aadd_texts(texts: list[str]) -&gt; list[str]:\n    async with self.engine.engine.connect() as conn:\n        # Async database operations\n        ...\n</code></pre> <p>Benefits: - High concurrency - Better resource utilization - Natural fit for modern Python</p>"},{"location":"development/architecture/#retry-decorators","title":"Retry Decorators","text":"<p>All operations use retry decorators:</p> <pre><code>@async_retry_with_backoff(\n    max_attempts=self.retry_max_attempts,\n    initial_backoff=self.retry_initial_backoff,\n    ...\n)\nasync def _insert_batch(batch: list) -&gt; None:\n    # Operation with automatic retry\n</code></pre> <p>Benefits: - Transparent retry logic - Configurable per operation - Handles 40001 errors automatically</p>"},{"location":"development/architecture/#dependency-injection","title":"Dependency Injection","text":"<p>Engine is injected into vector store:</p> <pre><code>vectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,  # Injected dependency\n    embeddings=embeddings,\n    collection_name=\"docs\",\n)\n</code></pre> <p>Benefits: - Testable (can mock engine) - Flexible configuration - Connection reuse</p>"},{"location":"development/architecture/#database-schema","title":"Database Schema","text":""},{"location":"development/architecture/#vector-store-table","title":"Vector Store Table","text":"<pre><code>CREATE TABLE {table_name} (\n    id UUID PRIMARY KEY,\n    content TEXT,\n    embedding VECTOR(n),\n    metadata JSONB,\n    created_at TIMESTAMPTZ DEFAULT now()\n);\n</code></pre>"},{"location":"development/architecture/#chat-history-table","title":"Chat History Table","text":"<pre><code>CREATE TABLE message_store (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    session_id TEXT NOT NULL,\n    message JSONB NOT NULL,\n    created_at TIMESTAMPTZ DEFAULT now()\n);\n\nCREATE INDEX ON message_store (session_id);\n</code></pre>"},{"location":"development/architecture/#sql-generation","title":"SQL Generation","text":""},{"location":"development/architecture/#filter-translation","title":"Filter Translation","text":"<p>Metadata filters are translated to SQL:</p> <pre><code>filter = {\"category\": \"tech\", \"year\": {\"$gte\": 2023}}\n\n# Becomes:\nWHERE metadata-&gt;&gt;'category' = 'tech'\n  AND CAST(metadata-&gt;&gt;'year' AS INTEGER) &gt;= 2023\n</code></pre>"},{"location":"development/architecture/#distance-operators","title":"Distance Operators","text":"<p>Different distance strategies use different operators:</p> Strategy Operator SQL COSINE <code>&lt;=&gt;</code> <code>ORDER BY embedding &lt;=&gt; :query</code> EUCLIDEAN <code>&lt;-&gt;</code> <code>ORDER BY embedding &lt;-&gt; :query</code> INNER_PRODUCT <code>&lt;#&gt;</code> <code>ORDER BY embedding &lt;#&gt; :query</code>"},{"location":"development/architecture/#error-handling","title":"Error Handling","text":""},{"location":"development/architecture/#retryable-errors","title":"Retryable Errors","text":"<p>Automatically retry on: - <code>40001</code>: Serialization errors - Connection errors - Timeout errors</p>"},{"location":"development/architecture/#non-retryable-errors","title":"Non-Retryable Errors","text":"<p>Fail immediately on: - Schema errors - Permission errors - Data validation errors</p>"},{"location":"development/architecture/#testing-strategy","title":"Testing Strategy","text":""},{"location":"development/architecture/#unit-tests","title":"Unit Tests","text":"<p>Test logic without database: - Filter SQL generation - Index configuration - Retry logic</p>"},{"location":"development/architecture/#integration-tests","title":"Integration Tests","text":"<p>Test with real CockroachDB: - Vector operations - Index creation - Concurrent operations</p>"},{"location":"development/architecture/#testcontainers","title":"Testcontainers","text":"<p>Use Docker containers for integration tests: <pre><code>@pytest.fixture\nasync def crdb_container():\n    container = CockroachDBContainer()\n    container.start()\n    yield container.get_connection_url()\n    container.stop()\n</code></pre></p>"},{"location":"development/architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"development/architecture/#connection-pooling","title":"Connection Pooling","text":"<ul> <li>Pool size: 10 (default)</li> <li>Max overflow: 20 (default)</li> <li>Pre-ping: Enabled</li> </ul>"},{"location":"development/architecture/#batch-operations","title":"Batch Operations","text":"<ul> <li>Default batch size: 100</li> <li>Configurable per operation</li> <li>Smaller batches for large vectors</li> </ul>"},{"location":"development/architecture/#query-optimization","title":"Query Optimization","text":"<ul> <li>Use indexes for large datasets</li> <li>Filter before vector search when possible</li> <li>Tune beam size for accuracy/speed tradeoff</li> </ul>"},{"location":"development/architecture/#extension-points","title":"Extension Points","text":""},{"location":"development/architecture/#custom-distance-functions","title":"Custom Distance Functions","text":"<p>Extend with custom distance strategies: <pre><code>class CustomDistance(DistanceStrategy):\n    name = \"custom\"\n    operator = \"custom_op\"\n</code></pre></p>"},{"location":"development/architecture/#custom-filters","title":"Custom Filters","text":"<p>Extend filter translator for custom operators: <pre><code>def _translate_filter(self, filter: dict) -&gt; str:\n    # Custom filter logic\n</code></pre></p>"},{"location":"development/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing - Join development</li> <li>Testing - Write tests</li> <li>API Reference - Detailed API</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to langchain-cockroachdb!</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#1-fork-and-clone","title":"1. Fork and Clone","text":"<pre><code># Fork on GitHub, then clone\ngit clone https://github.com/YOUR_USERNAME/langchain-cockroachdb.git\ncd langchain-cockroachdb\n</code></pre>"},{"location":"development/contributing/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code># Install with dev dependencies\npip install -e \".[dev]\"\n\n# Or with uv (recommended)\nuv pip install -e \".[dev]\"\n</code></pre>"},{"location":"development/contributing/#3-start-cockroachdb","title":"3. Start CockroachDB","text":"<pre><code>docker-compose up -d\n</code></pre>"},{"location":"development/contributing/#4-run-tests","title":"4. Run Tests","text":"<pre><code>make test\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-create-a-branch","title":"1. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make Changes","text":"<p>Follow the code style guidelines below.</p>"},{"location":"development/contributing/#3-run-checks","title":"3. Run Checks","text":"<pre><code># Run all checks\nmake all\n\n# Or individually:\nmake lint      # Linting\nmake format    # Formatting\nmake typecheck # Type checking\nmake test      # Tests\n</code></pre>"},{"location":"development/contributing/#4-commit-changes","title":"4. Commit Changes","text":"<pre><code>git add .\ngit commit -m \"feat: add new feature\"\n</code></pre> <p>Follow Conventional Commits: - <code>feat:</code> New feature - <code>fix:</code> Bug fix - <code>docs:</code> Documentation - <code>test:</code> Tests - <code>refactor:</code> Code refactoring - <code>chore:</code> Maintenance</p>"},{"location":"development/contributing/#5-push-and-create-pr","title":"5. Push and Create PR","text":"<pre><code>git push origin feature/your-feature-name\n</code></pre> <p>Then create a Pull Request on GitHub.</p>"},{"location":"development/contributing/#code-style","title":"Code Style","text":""},{"location":"development/contributing/#python-style","title":"Python Style","text":"<ul> <li>Follow PEP 8</li> <li>Use type hints</li> <li>Maximum line length: 100 characters</li> <li>Use async/await for I/O operations</li> </ul> <pre><code># Good\nasync def add_documents(\n    self,\n    texts: list[str],\n    metadatas: list[dict] | None = None,\n) -&gt; list[str]:\n    \"\"\"Add documents to the vector store.\n\n    Args:\n        texts: List of document texts\n        metadatas: Optional metadata for each document\n\n    Returns:\n        List of document IDs\n    \"\"\"\n    # Implementation\n</code></pre>"},{"location":"development/contributing/#linting","title":"Linting","text":"<pre><code># Auto-fix most issues\nmake format\n\n# Check linting\nmake lint\n</code></pre>"},{"location":"development/contributing/#type-checking","title":"Type Checking","text":"<pre><code>make typecheck\n</code></pre>"},{"location":"development/contributing/#testing","title":"Testing","text":""},{"location":"development/contributing/#test-structure","title":"Test Structure","text":"<pre><code>tests/\n\u251c\u2500\u2500 unit/           # Fast tests, no database\n\u2514\u2500\u2500 integration/    # Tests with CockroachDB\n</code></pre>"},{"location":"development/contributing/#writing-tests","title":"Writing Tests","text":"<pre><code>import pytest\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore\n\nclass TestVectorStore:\n    @pytest.mark.asyncio\n    async def test_add_texts(self, vectorstore):\n        \"\"\"Test adding texts to vector store.\"\"\"\n        texts = [\"doc1\", \"doc2\"]\n        ids = await vectorstore.aadd_texts(texts)\n\n        assert len(ids) == 2\n        assert all(isinstance(id, str) for id in ids)\n</code></pre>"},{"location":"development/contributing/#running-tests","title":"Running Tests","text":"<pre><code># All tests\nmake test\n\n# Unit tests only\npytest tests/unit -v\n\n# Specific test\npytest tests/unit/test_indexes.py::TestCSPANNIndex::test_index_creation -v\n\n# With coverage\npytest tests --cov=langchain_cockroachdb --cov-report=html\n</code></pre>"},{"location":"development/contributing/#test-requirements","title":"Test Requirements","text":"<ul> <li>\u2705 Tests must pass</li> <li>\u2705 Coverage should not decrease</li> <li>\u2705 Use fixtures for common setup</li> <li>\u2705 Mock external services when possible</li> </ul>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#docstrings","title":"Docstrings","text":"<p>Use Google-style docstrings:</p> <pre><code>def function(arg1: str, arg2: int = 10) -&gt; bool:\n    \"\"\"Short description.\n\n    Longer description if needed.\n\n    Args:\n        arg1: Description\n        arg2: Description (default: 10)\n\n    Returns:\n        Description\n\n    Raises:\n        ValueError: Description\n\n    Example:\n        ```python\n        result = function(\"value\", arg2=20)\n        ```\n    \"\"\"\n</code></pre>"},{"location":"development/contributing/#documentation-site","title":"Documentation Site","text":"<pre><code># Install docs dependencies\npip install -e \".[docs]\"\n\n# Serve locally\nmkdocs serve\n\n# Build\nmkdocs build\n</code></pre>"},{"location":"development/contributing/#adding-documentation","title":"Adding Documentation","text":"<ul> <li>Update relevant guide in <code>docs/guides/</code></li> <li>Add examples to <code>examples/</code></li> <li>Update README.md if needed</li> </ul>"},{"location":"development/contributing/#pull-request-guidelines","title":"Pull Request Guidelines","text":""},{"location":"development/contributing/#pr-checklist","title":"PR Checklist","text":"<ul> <li>[ ] Tests pass (<code>make test</code>)</li> <li>[ ] Linting passes (<code>make lint</code>)</li> <li>[ ] Type checking passes (<code>make typecheck</code>)</li> <li>[ ] Documentation updated</li> <li>[ ] CHANGELOG.md updated</li> <li>[ ] Commit messages follow Conventional Commits</li> </ul>"},{"location":"development/contributing/#pr-description-template","title":"PR Description Template","text":"<pre><code>## Description\nBrief description of changes\n\n## Type of Change\n- [ ] Bug fix\n- [ ] New feature\n- [ ] Breaking change\n- [ ] Documentation update\n\n## Testing\nHow were the changes tested?\n\n## Checklist\n- [ ] Tests pass\n- [ ] Linting passes\n- [ ] Documentation updated\n</code></pre>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<p>Maintainers only:</p> <ol> <li>Update version in <code>pyproject.toml</code></li> <li>Update <code>CHANGELOG.md</code></li> <li>Create git tag</li> <li>Push to GitHub</li> <li>GitHub Actions builds and publishes to PyPI</li> </ol>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> </ul>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful and inclusive. See CODE_OF_CONDUCT.md.</p>"},{"location":"development/contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the Apache License 2.0.</p>"},{"location":"development/testing/","title":"Testing Guide","text":"<p>Learn how to run and write tests for langchain-cockroachdb.</p>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<pre><code>tests/\n\u251c\u2500\u2500 conftest.py              # Shared fixtures\n\u251c\u2500\u2500 unit/                    # Fast tests, no database\n\u2502   \u251c\u2500\u2500 test_indexes.py\n\u2502   \u251c\u2500\u2500 test_hybrid_search.py\n\u2502   \u2514\u2500\u2500 test_retry.py\n\u2514\u2500\u2500 integration/             # Tests with CockroachDB\n    \u251c\u2500\u2500 test_engine.py\n    \u251c\u2500\u2500 test_vectorstore.py\n    \u251c\u2500\u2500 test_chat_history.py\n    \u251c\u2500\u2500 test_retry_behavior.py\n    \u251c\u2500\u2500 test_sync_wrapper.py\n    \u2514\u2500\u2500 test_configuration.py\n</code></pre>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>make test\n</code></pre>"},{"location":"development/testing/#unit-tests-only","title":"Unit Tests Only","text":"<pre><code>pytest tests/unit -v\n</code></pre>"},{"location":"development/testing/#integration-tests-only","title":"Integration Tests Only","text":"<pre><code>pytest tests/integration -v\n</code></pre>"},{"location":"development/testing/#specific-test-file","title":"Specific Test File","text":"<pre><code>pytest tests/unit/test_indexes.py -v\n</code></pre>"},{"location":"development/testing/#specific-test","title":"Specific Test","text":"<pre><code>pytest tests/unit/test_indexes.py::TestCSPANNIndex::test_index_creation -v\n</code></pre>"},{"location":"development/testing/#with-coverage","title":"With Coverage","text":"<pre><code>pytest tests --cov=langchain_cockroachdb --cov-report=html\nopen htmlcov/index.html\n</code></pre>"},{"location":"development/testing/#requirements","title":"Requirements","text":""},{"location":"development/testing/#unit-tests","title":"Unit Tests","text":"<ul> <li>No external dependencies</li> <li>Run anywhere</li> <li>Very fast (&lt;1s)</li> </ul>"},{"location":"development/testing/#integration-tests","title":"Integration Tests","text":"<ul> <li>Docker running</li> <li>Testcontainers library</li> <li>Takes longer (~1min)</li> </ul>"},{"location":"development/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"development/testing/#unit-test-example","title":"Unit Test Example","text":"<pre><code>import pytest\nfrom langchain_cockroachdb import CSPANNIndex, DistanceStrategy\n\nclass TestCSPANNIndex:\n    def test_index_creation(self):\n        \"\"\"Test creating C-SPANN index configuration.\"\"\"\n        index = CSPANNIndex(\n            name=\"test_index\",\n            distance_strategy=DistanceStrategy.COSINE,\n        )\n\n        assert index.name == \"test_index\"\n        assert index.distance_strategy == DistanceStrategy.COSINE\n\n    def test_index_sql_generation(self):\n        \"\"\"Test SQL generation for index creation.\"\"\"\n        index = CSPANNIndex()\n        sql = index.get_create_sql(\"table\", \"embedding\")\n\n        assert \"CREATE VECTOR INDEX\" in sql\n        assert \"table\" in sql\n        assert \"embedding\" in sql\n</code></pre>"},{"location":"development/testing/#integration-test-example","title":"Integration Test Example","text":"<pre><code>import pytest\nfrom langchain_core.embeddings import DeterministicFakeEmbedding\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\n\nclass TestVectorStore:\n    @pytest.mark.asyncio\n    async def test_add_and_search(self, connection_string: str):\n        \"\"\"Test adding documents and searching.\"\"\"\n        # Setup\n        engine = CockroachDBEngine.from_connection_string(connection_string)\n        await engine.ainit_vectorstore_table(\n            table_name=\"test_docs\",\n            vector_dimension=384,\n            drop_if_exists=True,\n        )\n\n        embeddings = DeterministicFakeEmbedding(size=384)\n        vectorstore = AsyncCockroachDBVectorStore(\n            engine=engine,\n            embeddings=embeddings,\n            collection_name=\"test_docs\",\n        )\n\n        # Test\n        texts = [\"doc1\", \"doc2\", \"doc3\"]\n        ids = await vectorstore.aadd_texts(texts)\n\n        assert len(ids) == 3\n\n        results = await vectorstore.asimilarity_search(\"doc1\", k=2)\n\n        assert len(results) == 2\n        assert results[0].page_content in texts\n\n        # Cleanup\n        await engine.aclose()\n</code></pre>"},{"location":"development/testing/#fixtures","title":"Fixtures","text":""},{"location":"development/testing/#common-fixtures","title":"Common Fixtures","text":"<p>Available in <code>conftest.py</code>:</p> <pre><code>@pytest.fixture\ndef connection_string() -&gt; str:\n    \"\"\"Get CockroachDB connection string.\"\"\"\n    return os.getenv(\n        \"COCKROACHDB_URL\",\n        \"cockroachdb://root@localhost:26257/defaultdb?sslmode=disable\"\n    )\n\n@pytest.fixture\nasync def engine(connection_string: str):\n    \"\"\"Get CockroachDB engine.\"\"\"\n    engine = CockroachDBEngine.from_connection_string(connection_string)\n    yield engine\n    await engine.aclose()\n\n@pytest.fixture\nasync def vectorstore(engine: CockroachDBEngine):\n    \"\"\"Get vector store with test table.\"\"\"\n    await engine.ainit_vectorstore_table(\n        table_name=\"test_vectors\",\n        vector_dimension=384,\n        drop_if_exists=True,\n    )\n\n    embeddings = DeterministicFakeEmbedding(size=384)\n    vs = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"test_vectors\",\n    )\n\n    yield vs\n</code></pre>"},{"location":"development/testing/#test-guidelines","title":"Test Guidelines","text":""},{"location":"development/testing/#1-use-descriptive-names","title":"1. Use Descriptive Names","text":"<pre><code># Good\nasync def test_add_texts_with_metadata_returns_correct_ids():\n    ...\n\n# Bad\nasync def test_add():\n    ...\n</code></pre>"},{"location":"development/testing/#2-test-one-thing","title":"2. Test One Thing","text":"<pre><code># Good: Tests one behavior\nasync def test_add_texts_returns_ids():\n    ids = await vectorstore.aadd_texts([\"doc1\"])\n    assert len(ids) == 1\n\n# Bad: Tests multiple behaviors\nasync def test_vectorstore():\n    ids = await vectorstore.aadd_texts([\"doc1\"])\n    results = await vectorstore.asimilarity_search(\"doc1\")\n    await vectorstore.adelete(ids)\n    # Too much in one test\n</code></pre>"},{"location":"development/testing/#3-use-fixtures","title":"3. Use Fixtures","text":"<pre><code># Good: Uses fixture\nasync def test_search(vectorstore):\n    await vectorstore.aadd_texts([\"doc1\"])\n    results = await vectorstore.asimilarity_search(\"doc1\")\n    assert len(results) &gt; 0\n\n# Bad: Setup in test\nasync def test_search():\n    engine = CockroachDBEngine.from_connection_string(...)\n    await engine.ainit_vectorstore_table(...)\n    vectorstore = AsyncCockroachDBVectorStore(...)\n    # Repeated setup\n</code></pre>"},{"location":"development/testing/#4-clean-up-resources","title":"4. Clean Up Resources","text":"<pre><code>@pytest.fixture\nasync def resource():\n    # Setup\n    r = create_resource()\n\n    yield r\n\n    # Cleanup (always runs)\n    await r.close()\n</code></pre>"},{"location":"development/testing/#test-coverage","title":"Test Coverage","text":""},{"location":"development/testing/#current-coverage","title":"Current Coverage","text":"<pre><code>pytest tests --cov=langchain_cockroachdb --cov-report=term\n\n# Shows:\nName                                    Stmts   Miss  Cover\n-----------------------------------------------------------\nlangchain_cockroachdb/__init__.py          10      0   100%\nlangchain_cockroachdb/engine.py            89      5    94%\nlangchain_cockroachdb/vectorstore.py      245     12    95%\n...\n-----------------------------------------------------------\nTOTAL                                    1234     45    96%\n</code></pre>"},{"location":"development/testing/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Overall: &gt;90%</li> <li>Core modules: &gt;95%</li> <li>New features: 100%</li> </ul>"},{"location":"development/testing/#continuous-integration","title":"Continuous Integration","text":"<p>Tests run automatically on: - Every push - Every pull request - Python 3.10, 3.11, 3.12</p>"},{"location":"development/testing/#github-actions","title":"GitHub Actions","text":"<pre><code>name: Tests\non: [push, pull_request]\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        python-version: [\"3.10\", \"3.11\", \"3.12\"]\n    steps:\n      - uses: actions/checkout@v4\n      - name: Setup Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: ${{ matrix.python-version }}\n      - name: Run tests\n        run: make test\n</code></pre>"},{"location":"development/testing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/testing/#docker-not-running","title":"Docker Not Running","text":"<pre><code># Start Docker Desktop\n# Then:\ndocker ps  # Verify Docker works\n</code></pre>"},{"location":"development/testing/#connection-refused","title":"Connection Refused","text":"<pre><code># Start CockroachDB\ndocker-compose up -d\n\n# Wait for it to be ready\ndocker logs cockroachdb\n</code></pre>"},{"location":"development/testing/#slow-tests","title":"Slow Tests","text":"<pre><code># Run only fast unit tests\npytest tests/unit -v\n\n# Or run specific test\npytest tests/integration/test_vectorstore.py::TestVectorStore::test_add_texts -v\n</code></pre>"},{"location":"development/testing/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing - Submit changes</li> <li>Architecture - Understand design</li> <li>API Reference - API details</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>Working code examples demonstrating langchain-cockroachdb features.</p>"},{"location":"examples/#available-examples","title":"Available Examples","text":"<p>All examples are available in the <code>examples/</code> directory of the repository.</p>"},{"location":"examples/#basic-usage","title":"Basic Usage","text":"Example Description Features quickstart.py Get started in 5 minutes Basic CRUD, search sync_usage.py Synchronous API Sync wrapper, simple scripts"},{"location":"examples/#advanced-features","title":"Advanced Features","text":"Example Description Features vector_indexes.py Optimize query performance C-SPANN indexes, tuning hybrid_search.py Combine FTS + vectors Fusion strategies metadata_filtering.py Complex metadata queries Advanced filters"},{"location":"examples/#configuration","title":"Configuration","text":"Example Description Features retry_configuration.py Production configurations Retry logic, connection pooling"},{"location":"examples/#chat-applications","title":"Chat Applications","text":"Example Description Features chat_history.py Persistent conversations Session management"},{"location":"examples/#running-examples","title":"Running Examples","text":""},{"location":"examples/#prerequisites","title":"Prerequisites","text":"<ol> <li> <p>CockroachDB running: <pre><code>docker-compose up -d\n</code></pre></p> </li> <li> <p>Install package: <pre><code>pip install langchain-cockroachdb langchain-openai\n</code></pre></p> </li> <li> <p>Set connection string (optional): <pre><code>export COCKROACHDB_URL=\"cockroachdb://root@localhost:26257/defaultdb?sslmode=disable\"\n</code></pre></p> </li> <li> <p>Set OpenAI key (for some examples): <pre><code>export OPENAI_API_KEY=\"your-key-here\"\n</code></pre></p> </li> </ol>"},{"location":"examples/#run-an-example","title":"Run an Example","text":"<pre><code>cd examples\npython quickstart.py\n</code></pre>"},{"location":"examples/#example-categories","title":"Example Categories","text":""},{"location":"examples/#getting-started","title":"Getting Started","text":"<ul> <li>Basic Usage - CRUD operations, simple search</li> <li>Quick start guides for common scenarios</li> </ul>"},{"location":"examples/#advanced-techniques","title":"Advanced Techniques","text":"<ul> <li>Advanced Filtering - Complex queries, hybrid search</li> <li>Index Optimization - Performance tuning</li> </ul>"},{"location":"examples/#production-patterns","title":"Production Patterns","text":"<ul> <li>Configuration for different workloads</li> <li>Error handling and retry logic</li> <li>Multi-tenancy patterns</li> </ul>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>Guides - Learn key concepts</li> <li>API Reference - Detailed API docs</li> <li>Configuration - Optimize for your workload</li> </ul>"},{"location":"examples/advanced-filtering/","title":"Advanced Filtering &amp; Hybrid Search","text":"<p>Complex queries and hybrid search examples.</p>"},{"location":"examples/advanced-filtering/#advanced-metadata-filtering","title":"Advanced Metadata Filtering","text":"<p>File: <code>examples/metadata_filtering.py</code></p>"},{"location":"examples/advanced-filtering/#comparison-operators","title":"Comparison Operators","text":"<pre><code># Greater than\nresults = await vectorstore.asimilarity_search(\n    \"recent articles\",\n    k=10,\n    filter={\"year\": {\"$gte\": 2023}}\n)\n\n# Multiple conditions\nresults = await vectorstore.asimilarity_search(\n    \"high quality tech content\",\n    k=10,\n    filter={\n        \"category\": \"tech\",\n        \"score\": {\"$gte\": 0.8},\n        \"year\": {\"$gte\": 2023}\n    }\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#in-and-not-in","title":"IN and NOT IN","text":"<pre><code># IN operator\nresults = await vectorstore.asimilarity_search(\n    \"science content\",\n    k=10,\n    filter={\"source\": {\"$in\": [\"arxiv\", \"nature\", \"ieee\"]}}\n)\n\n# NOT IN operator\nresults = await vectorstore.asimilarity_search(\n    \"published content\",\n    k=10,\n    filter={\"status\": {\"$nin\": [\"draft\", \"archived\"]}}\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#logical-operators","title":"Logical Operators","text":"<pre><code># OR operator\nresults = await vectorstore.asimilarity_search(\n    \"research\",\n    k=10,\n    filter={\n        \"$or\": [\n            {\"category\": \"science\"},\n            {\"category\": \"research\"}\n        ]\n    }\n)\n\n# Complex nested filters\nresults = await vectorstore.asimilarity_search(\n    \"innovation\",\n    k=10,\n    filter={\n        \"$and\": [\n            {\"year\": {\"$gte\": 2023}},\n            {\n                \"$or\": [\n                    {\"category\": \"tech\"},\n                    {\"category\": \"science\"}\n                ]\n            },\n            {\"quality_score\": {\"$gte\": 0.7}}\n        ]\n    }\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#hybrid-search","title":"Hybrid Search","text":"<p>Combining full-text search with vector similarity.</p> <p>File: <code>examples/hybrid_search.py</code></p>"},{"location":"examples/advanced-filtering/#basic-hybrid-search","title":"Basic Hybrid Search","text":"<pre><code>from langchain_cockroachdb import HybridSearchConfig\n\n# Configure hybrid search\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.5,\n    fts_weight=0.5,\n    fusion_type=\"weighted_sum\",\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    hybrid_search_config=hybrid_config,\n)\n\n# Enable FTS\nawait vectorstore.aapply_hybrid_search()\n\n# Search with both methods\nresults = await vectorstore.ahybrid_search(\n    \"CockroachDB SERIALIZABLE isolation\",\n    k=10\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#fusion-strategies","title":"Fusion Strategies","text":"<pre><code># Weighted sum (emphasize semantic)\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.7,\n    fts_weight=0.3,\n    fusion_type=\"weighted_sum\",\n)\n\n# Reciprocal Rank Fusion\nhybrid_config = HybridSearchConfig(\n    fusion_type=\"reciprocal_rank_fusion\",\n    rrf_k=60,\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#multi-tenant-patterns","title":"Multi-Tenant Patterns","text":"<pre><code># Add tenant isolation\ntexts = [\"Doc 1\", \"Doc 2\", \"Doc 3\"]\nmetadatas = [\n    {\"tenant_id\": \"tenant-123\", \"category\": \"tech\"},\n    {\"tenant_id\": \"tenant-456\", \"category\": \"science\"},\n    {\"tenant_id\": \"tenant-123\", \"category\": \"tech\"},\n]\n\nawait vectorstore.aadd_texts(texts, metadatas=metadatas)\n\n# Query with tenant filter\nresults = await vectorstore.asimilarity_search(\n    \"tech content\",\n    k=10,\n    filter={\"tenant_id\": \"tenant-123\"}\n)\n</code></pre>"},{"location":"examples/advanced-filtering/#next-steps","title":"Next Steps","text":"<ul> <li>Index Optimization - Performance tuning</li> <li>Hybrid Search Guide - Detailed guide</li> <li>Vector Store Guide - Full API</li> </ul>"},{"location":"examples/basic-usage/","title":"Basic Usage Examples","text":"<p>Core examples for getting started with langchain-cockroachdb.</p>"},{"location":"examples/basic-usage/#quickstart","title":"Quickstart","text":"<p>Complete example from zero to searching in 5 minutes.</p> <p>File: <code>examples/quickstart.py</code></p> <pre><code>import asyncio\nimport os\nfrom langchain_core.embeddings import DeterministicFakeEmbedding\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\n\nasync def main():\n    # 1. Initialize engine\n    engine = CockroachDBEngine.from_connection_string(\n        os.getenv(\"COCKROACHDB_URL\", \n                  \"cockroachdb://root@localhost:26257/defaultdb?sslmode=disable\")\n    )\n\n    # 2. Create table\n    await engine.ainit_vectorstore_table(\n        table_name=\"quickstart\",\n        vector_dimension=384,\n        drop_if_exists=True,\n    )\n\n    # 3. Initialize vector store\n    embeddings = DeterministicFakeEmbedding(size=384)\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"quickstart\",\n    )\n\n    # 4. Add documents\n    texts = [\n        \"CockroachDB is a distributed SQL database\",\n        \"LangChain makes building LLM apps easy\",\n        \"Vector search enables semantic similarity\",\n    ]\n    ids = await vectorstore.aadd_texts(texts)\n    print(f\"\u2705 Added {len(ids)} documents\")\n\n    # 5. Search\n    results = await vectorstore.asimilarity_search(\n        \"Tell me about databases\",\n        k=2\n    )\n\n    print(\"\\n\ud83d\udd0d Search Results:\")\n    for i, doc in enumerate(results, 1):\n        print(f\"{i}. {doc.page_content}\")\n\n    # 6. Cleanup\n    await engine.aclose()\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>Output: <pre><code>\u2705 Added 3 documents\n\n\ud83d\udd0d Search Results:\n1. CockroachDB is a distributed SQL database\n2. Vector search enables semantic similarity\n</code></pre></p>"},{"location":"examples/basic-usage/#sync-wrapper","title":"Sync Wrapper","text":"<p>Using the synchronous API for simple scripts.</p> <p>File: <code>examples/sync_usage.py</code></p> <pre><code>import os\nfrom langchain_core.embeddings import DeterministicFakeEmbedding\nfrom langchain_cockroachdb import CockroachDBVectorStore, CockroachDBEngine\n\ndef main():\n    # Initialize (no async/await needed)\n    engine = CockroachDBEngine.from_connection_string(\n        os.getenv(\"COCKROACHDB_URL\")\n    )\n\n    engine.init_vectorstore_table(\n        table_name=\"sync_demo\",\n        vector_dimension=384,\n        drop_if_exists=True,\n    )\n\n    embeddings = DeterministicFakeEmbedding(size=384)\n    vectorstore = CockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"sync_demo\",\n    )\n\n    # Add documents (sync)\n    texts = [\"Document 1\", \"Document 2\", \"Document 3\"]\n    ids = vectorstore.add_texts(texts)\n    print(f\"Added {len(ids)} documents\")\n\n    # Search (sync)\n    results = vectorstore.similarity_search(\"document\", k=2)\n    for doc in results:\n        print(f\"- {doc.page_content}\")\n\n    # Cleanup\n    engine.close()\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"examples/basic-usage/#chat-history","title":"Chat History","text":"<p>Persistent conversation storage.</p> <p>File: <code>examples/chat_history.py</code></p> <pre><code>import os\nfrom langchain_cockroachdb import CockroachDBChatMessageHistory\nfrom langchain.chains import ConversationChain\nfrom langchain.memory import ConversationBufferMemory\nfrom langchain_openai import ChatOpenAI\n\ndef main():\n    # Initialize chat history\n    history = CockroachDBChatMessageHistory(\n        session_id=\"user-123\",\n        connection_string=os.getenv(\"COCKROACHDB_URL\"),\n    )\n\n    # Create memory\n    memory = ConversationBufferMemory(\n        chat_memory=history,\n        return_messages=True,\n    )\n\n    # Create chatbot\n    chatbot = ConversationChain(\n        llm=ChatOpenAI(model=\"gpt-4\"),\n        memory=memory,\n        verbose=True,\n    )\n\n    # First interaction\n    response1 = chatbot.predict(input=\"My name is Alice\")\n    print(f\"Bot: {response1}\")\n\n    # Later interaction (history is remembered)\n    response2 = chatbot.predict(input=\"What's my name?\")\n    print(f\"Bot: {response2}\")\n\n    # View history\n    messages = history.messages\n    print(f\"\\n\ud83d\udcdd Chat history: {len(messages)} messages\")\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"examples/basic-usage/#with-real-embeddings","title":"With Real Embeddings","text":"<p>Using OpenAI embeddings instead of fake embeddings.</p> <pre><code>import asyncio\nimport os\nfrom langchain_openai import OpenAIEmbeddings\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\n\nasync def main():\n    engine = CockroachDBEngine.from_connection_string(\n        os.getenv(\"COCKROACHDB_URL\")\n    )\n\n    await engine.ainit_vectorstore_table(\n        table_name=\"real_embeddings\",\n        vector_dimension=1536,  # OpenAI ada-002\n        drop_if_exists=True,\n    )\n\n    # Use real embeddings\n    embeddings = OpenAIEmbeddings(model=\"text-embedding-3-small\")\n\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"real_embeddings\",\n    )\n\n    # Add documents with semantic meaning\n    texts = [\n        \"The capital of France is Paris\",\n        \"Paris is known for the Eiffel Tower\",\n        \"Tokyo is the capital of Japan\",\n    ]\n    await vectorstore.aadd_texts(texts)\n\n    # Semantic search\n    results = await vectorstore.asimilarity_search(\n        \"What is the capital city of France?\",\n        k=2\n    )\n\n    for doc in results:\n        print(doc.page_content)\n\n    await engine.aclose()\n\nasyncio.run(main())\n</code></pre>"},{"location":"examples/basic-usage/#with-metadata","title":"With Metadata","text":"<p>Adding and filtering documents by metadata.</p> <pre><code>async def metadata_example():\n    # Add documents with metadata\n    texts = [\n        \"CockroachDB documentation\",\n        \"LangChain tutorial\",\n        \"Vector search guide\",\n    ]\n    metadatas = [\n        {\"category\": \"database\", \"source\": \"docs\", \"year\": 2024},\n        {\"category\": \"ai\", \"source\": \"tutorial\", \"year\": 2024},\n        {\"category\": \"ai\", \"source\": \"guide\", \"year\": 2023},\n    ]\n\n    await vectorstore.aadd_texts(texts, metadatas=metadatas)\n\n    # Filter by metadata\n    results = await vectorstore.asimilarity_search(\n        \"AI content\",\n        k=5,\n        filter={\"category\": \"ai\"}\n    )\n\n    print(\"AI documents:\")\n    for doc in results:\n        print(f\"- {doc.page_content} ({doc.metadata['year']})\")\n</code></pre>"},{"location":"examples/basic-usage/#next-steps","title":"Next Steps","text":"<ul> <li>Advanced Filtering - Complex queries</li> <li>Index Optimization - Performance tuning</li> <li>Guides - Detailed guides</li> </ul>"},{"location":"examples/index-optimization/","title":"Index Optimization","text":"<p>Performance optimization with C-SPANN indexes.</p> <p>File: <code>examples/vector_indexes.py</code></p>"},{"location":"examples/index-optimization/#creating-indexes","title":"Creating Indexes","text":"<pre><code>from langchain_cockroachdb import CSPANNIndex, DistanceStrategy\n\n# Basic index\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n\n# With distance strategy\nindex = CSPANNIndex(distance_strategy=DistanceStrategy.COSINE)\nawait vectorstore.aapply_vector_index(index)\n\n# With partition tuning\nindex = CSPANNIndex(\n    min_partition_size=10,\n    max_partition_size=100,\n)\nawait vectorstore.aapply_vector_index(index)\n</code></pre>"},{"location":"examples/index-optimization/#performance-comparison","title":"Performance Comparison","text":"<pre><code>import time\n\n# Without index\nstart = time.time()\nresults = await vectorstore.asimilarity_search(\"query\", k=10)\nno_index_time = time.time() - start\n\n# Create index\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n\n# With index\nstart = time.time()\nresults = await vectorstore.asimilarity_search(\"query\", k=10)\nwith_index_time = time.time() - start\n\nprint(f\"Without index: {no_index_time*1000:.1f}ms\")\nprint(f\"With index: {with_index_time*1000:.1f}ms\")\nprint(f\"Speedup: {no_index_time/with_index_time:.1f}x\")\n</code></pre>"},{"location":"examples/index-optimization/#query-time-tuning","title":"Query-Time Tuning","text":"<pre><code># Adjust beam size for accuracy/speed tradeoff\nasync with engine.engine.connect() as conn:\n    # Higher beam = more accurate, slower\n    await conn.execute(text(\"SET vector_search_beam_size = 200\"))\n    results = await vectorstore.asimilarity_search(\"query\", k=10)\n\n    # Lower beam = faster, less accurate\n    await conn.execute(text(\"SET vector_search_beam_size = 50\"))\n    results = await vectorstore.asimilarity_search(\"query\", k=10)\n</code></pre>"},{"location":"examples/index-optimization/#next-steps","title":"Next Steps","text":"<ul> <li>Vector Indexes Guide - Complete guide</li> <li>Configuration - Tuning options</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>Learn how to configure langchain-cockroachdb for different workloads.</p>"},{"location":"getting-started/configuration/#engine-configuration","title":"Engine Configuration","text":""},{"location":"getting-started/configuration/#basic-configuration","title":"Basic Configuration","text":"<pre><code>from langchain_cockroachdb import CockroachDBEngine\n\nengine = CockroachDBEngine.from_connection_string(\n    \"cockroachdb://user:pass@host:26257/db\",\n    pool_size=10,                    # Base connections\n    max_overflow=20,                 # Additional connections\n    pool_pre_ping=True,              # Health check before use\n    pool_recycle=3600,               # Recycle after 1 hour\n    pool_timeout=30.0,               # Wait 30s for connection\n)\n</code></pre>"},{"location":"getting-started/configuration/#retry-configuration","title":"Retry Configuration","text":"<p>All operations automatically retry on transient errors (40001, connection failures):</p> <pre><code>engine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    retry_max_attempts=5,            # Max retries (default: 5)\n    retry_initial_backoff=0.1,       # Initial delay in seconds\n    retry_max_backoff=10.0,          # Max delay in seconds\n    retry_backoff_multiplier=2.0,    # Exponential multiplier\n    retry_jitter=True,               # Add randomization\n)\n</code></pre>"},{"location":"getting-started/configuration/#vector-store-configuration","title":"Vector Store Configuration","text":""},{"location":"getting-started/configuration/#basic-settings","title":"Basic Settings","text":"<pre><code>from langchain_cockroachdb import AsyncCockroachDBVectorStore\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"documents\",\n\n    # Column names\n    content_column=\"content\",\n    embedding_column=\"embedding\",\n    metadata_column=\"metadata\",\n    id_column=\"id\",\n\n    # Distance metric\n    distance_strategy=DistanceStrategy.COSINE,  # or L2, IP\n\n    # Batch size for inserts\n    batch_size=100,\n)\n</code></pre>"},{"location":"getting-started/configuration/#retry-settings-per-batch","title":"Retry Settings (Per-Batch)","text":"<pre><code>vectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"documents\",\n    retry_max_attempts=3,            # Per-batch retries\n    retry_initial_backoff=0.1,\n    retry_max_backoff=5.0,\n)\n</code></pre>"},{"location":"getting-started/configuration/#configuration-presets","title":"Configuration Presets","text":""},{"location":"getting-started/configuration/#development","title":"Development","text":"<pre><code># Optimized for local development\nengine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=5,\n    max_overflow=10,\n    retry_max_attempts=3,\n    retry_max_backoff=1.0,\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=100,\n)\n</code></pre>"},{"location":"getting-started/configuration/#web-applications","title":"Web Applications","text":"<pre><code># High concurrency, aggressive retries\nengine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=20,\n    max_overflow=40,\n    retry_max_attempts=10,\n    retry_max_backoff=30.0,\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=100,\n    retry_max_attempts=5,\n)\n</code></pre>"},{"location":"getting-started/configuration/#batch-jobs","title":"Batch Jobs","text":"<pre><code># Resilient, patient retries\nengine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=3,\n    max_overflow=5,\n    retry_max_attempts=20,\n    retry_max_backoff=60.0,\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=500,  # Larger batches for throughput\n    retry_max_attempts=10,\n)\n</code></pre>"},{"location":"getting-started/configuration/#multi-region","title":"Multi-Region","text":"<pre><code># High latency tolerance\nengine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=15,\n    max_overflow=30,\n    retry_max_attempts=15,\n    retry_max_backoff=60.0,\n    pool_timeout=60.0,  # Longer timeout\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=200,  # Moderate batches\n    retry_max_attempts=8,\n)\n</code></pre>"},{"location":"getting-started/configuration/#batch-size-guidelines","title":"Batch Size Guidelines","text":"<p>Choose batch size based on embedding dimensions and workload:</p> Embedding Size Recommended Batch Size &lt; 512 dims 200-500 512-1536 dims 100-200 &gt; 1536 dims 50-100 <p>CockroachDB works best with smaller batches compared to single-node databases.</p>"},{"location":"getting-started/configuration/#connection-pool-sizing","title":"Connection Pool Sizing","text":"<p>General guidelines:</p> Workload Type pool_size max_overflow Development 5 10 Web (low traffic) 10 20 Web (high traffic) 20-50 40-100 Batch jobs 3-5 5-10 Analytics 10-20 20-40 <p>Formula: <code>max_connections = pool_size + max_overflow</code></p>"},{"location":"getting-started/configuration/#monitoring-configuration","title":"Monitoring Configuration","text":""},{"location":"getting-started/configuration/#enable-sql-logging","title":"Enable SQL Logging","text":"<pre><code>import logging\n\nlogging.basicConfig()\nlogging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)\n</code></pre>"},{"location":"getting-started/configuration/#enable-pool-logging","title":"Enable Pool Logging","text":"<pre><code>engine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    echo=True,        # Log all SQL\n    echo_pool=True,   # Log pool events\n)\n</code></pre>"},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":"<p>Store sensitive configuration in environment variables:</p> <pre><code>export COCKROACHDB_URL=\"cockroachdb://user:pass@host:26257/db?sslmode=verify-full\"\nexport COCKROACHDB_POOL_SIZE=\"20\"\nexport COCKROACHDB_MAX_OVERFLOW=\"40\"\n</code></pre> <pre><code>import os\n\nengine = CockroachDBEngine.from_connection_string(\n    os.getenv(\"COCKROACHDB_URL\"),\n    pool_size=int(os.getenv(\"COCKROACHDB_POOL_SIZE\", \"10\")),\n    max_overflow=int(os.getenv(\"COCKROACHDB_MAX_OVERFLOW\", \"20\")),\n)\n</code></pre>"},{"location":"getting-started/configuration/#ssl-configuration","title":"SSL Configuration","text":""},{"location":"getting-started/configuration/#cockroachdb-cloud","title":"CockroachDB Cloud","text":"<pre><code>connection_string = (\n    \"cockroachdb://user:pass@cluster.cloud:26257/db\"\n    \"?sslmode=verify-full\"\n    \"&amp;sslrootcert=/path/to/root.crt\"\n)\n</code></pre>"},{"location":"getting-started/configuration/#self-hosted-with-custom-ca","title":"Self-Hosted with Custom CA","text":"<pre><code>connection_string = (\n    \"cockroachdb://user@host:26257/db\"\n    \"?sslmode=verify-full\"\n    \"&amp;sslcert=/path/to/client.crt\"\n    \"&amp;sslkey=/path/to/client.key\"\n    \"&amp;sslrootcert=/path/to/ca.crt\"\n)\n</code></pre>"},{"location":"getting-started/configuration/#insecure-development-only","title":"Insecure (Development Only)","text":"<pre><code>connection_string = \"cockroachdb://root@localhost:26257/db?sslmode=disable\"\n</code></pre>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Vector Indexes - Optimize queries</li> <li>Async vs Sync - Choose the right API</li> <li>Examples - See configurations in action</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or higher</li> <li>CockroachDB 24.2 or higher (for native vector support)</li> </ul>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install langchain-cockroachdb\n</code></pre> <p>Or with uv (recommended):</p> <pre><code>uv pip install langchain-cockroachdb\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from Source","text":"<pre><code>git clone https://github.com/cockroachdb/langchain-cockroachdb.git\ncd langchain-cockroachdb\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For contributing or development:</p> <pre><code>git clone https://github.com/cockroachdb/langchain-cockroachdb.git\ncd langchain-cockroachdb\npip install -e \".[dev]\"\n</code></pre> <p>This installs additional dependencies: - pytest (testing) - pytest-asyncio (async testing) - ruff (linting/formatting) - mypy (type checking) - testcontainers (integration testing)</p>"},{"location":"getting-started/installation/#cockroachdb-setup","title":"CockroachDB Setup","text":""},{"location":"getting-started/installation/#option-1-cockroachdb-cloud-recommended","title":"Option 1: CockroachDB Cloud (Recommended)","text":"<ol> <li>Sign up at cockroachlabs.cloud</li> <li>Create a free cluster</li> <li>Get your connection string</li> <li>Download the SSL certificate</li> </ol>"},{"location":"getting-started/installation/#option-2-docker-development","title":"Option 2: Docker (Development)","text":"<pre><code>docker run -d \\\n  --name cockroachdb \\\n  -p 26257:26257 \\\n  -p 8080:8080 \\\n  cockroachdb/cockroach:latest \\\n  start-single-node --insecure\n</code></pre>"},{"location":"getting-started/installation/#option-3-local-binary","title":"Option 3: Local Binary","text":"<p>Download from cockroachlabs.com/docs/releases</p> <pre><code>cockroach start-single-node --insecure --listen-addr=localhost:26257\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>import asyncio\nfrom langchain_cockroachdb import CockroachDBEngine\n\nasync def test():\n    engine = CockroachDBEngine.from_connection_string(\n        \"cockroachdb://root@localhost:26257/defaultdb?sslmode=disable\"\n    )\n    async with engine.engine.connect() as conn:\n        from sqlalchemy import text\n        result = await conn.execute(text(\"SELECT version()\"))\n        print(f\"\u2705 Connected: {result.scalar()}\")\n    await engine.aclose()\n\nasyncio.run(test())\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Build your first application</li> <li>Configuration - Learn about configuration options</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get started with langchain-cockroachdb in 5 minutes!</p>"},{"location":"getting-started/quick-start/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10+</li> <li>CockroachDB running (Cloud, Docker, or local)</li> <li>langchain-cockroachdb installed</li> </ul>"},{"location":"getting-started/quick-start/#basic-vector-store-example","title":"Basic Vector Store Example","text":"<pre><code>import asyncio\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\nfrom langchain_core.embeddings import DeterministicFakeEmbedding\n\nasync def main():\n    # 1. Create engine\n    engine = CockroachDBEngine.from_connection_string(\n        \"cockroachdb://root@localhost:26257/defaultdb?sslmode=disable\"\n    )\n\n    # 2. Initialize table\n    await engine.ainit_vectorstore_table(\n        table_name=\"my_documents\",\n        vector_dimension=384,\n        drop_if_exists=True,\n    )\n\n    # 3. Create vector store\n    embeddings = DeterministicFakeEmbedding(size=384)\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"my_documents\",\n    )\n\n    # 4. Add documents\n    texts = [\n        \"CockroachDB is a distributed SQL database\",\n        \"LangChain simplifies building LLM applications\",\n        \"Vector search enables semantic similarity\",\n    ]\n    ids = await vectorstore.aadd_texts(texts)\n    print(f\"Added {len(ids)} documents\")\n\n    # 5. Search\n    results = await vectorstore.asimilarity_search(\n        \"Tell me about databases\",\n        k=2\n    )\n\n    for doc in results:\n        print(f\"- {doc.page_content}\")\n\n    # 6. Cleanup\n    await engine.aclose()\n\nasyncio.run(main())\n</code></pre>"},{"location":"getting-started/quick-start/#with-real-embeddings-openai","title":"With Real Embeddings (OpenAI)","text":"<pre><code>from langchain_openai import OpenAIEmbeddings\nimport os\n\nos.environ[\"OPENAI_API_KEY\"] = \"your-key-here\"\n\nembeddings = OpenAIEmbeddings(model=\"text-embedding-3-small\")\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"documents\",\n)\n</code></pre>"},{"location":"getting-started/quick-start/#synchronous-usage","title":"Synchronous Usage","text":"<p>For simple scripts:</p> <pre><code>from langchain_cockroachdb import CockroachDBVectorStore\n\n# Same API, but synchronous\nvectorstore = CockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"documents\",\n)\n\n# Add documents (no await)\nids = vectorstore.add_texts(texts)\n\n# Search (no await)\nresults = vectorstore.similarity_search(\"query\", k=5)\n</code></pre>"},{"location":"getting-started/quick-start/#with-metadata","title":"With Metadata","text":"<pre><code>texts = [\"Doc 1\", \"Doc 2\", \"Doc 3\"]\nmetadatas = [\n    {\"source\": \"web\", \"category\": \"tech\"},\n    {\"source\": \"pdf\", \"category\": \"science\"},\n    {\"source\": \"web\", \"category\": \"tech\"},\n]\n\nawait vectorstore.aadd_texts(texts, metadatas=metadatas)\n\n# Filter by metadata\nresults = await vectorstore.asimilarity_search(\n    \"tech content\",\n    k=5,\n    filter={\"category\": \"tech\"}\n)\n</code></pre>"},{"location":"getting-started/quick-start/#common-patterns","title":"Common Patterns","text":""},{"location":"getting-started/quick-start/#1-document-loading","title":"1. Document Loading","text":"<pre><code>from langchain_community.document_loaders import TextLoader\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\n\n# Load documents\nloader = TextLoader(\"document.txt\")\ndocuments = loader.load()\n\n# Split into chunks\ntext_splitter = RecursiveCharacterTextSplitter(\n    chunk_size=1000,\n    chunk_overlap=200,\n)\nchunks = text_splitter.split_documents(documents)\n\n# Add to vector store\nawait vectorstore.aadd_documents(chunks)\n</code></pre>"},{"location":"getting-started/quick-start/#2-retrieval-chain","title":"2. Retrieval Chain","text":"<pre><code>from langchain.chains import RetrievalQA\nfrom langchain_openai import ChatOpenAI\n\n# Create retriever\nretriever = vectorstore.as_retriever(search_kwargs={\"k\": 5})\n\n# Create QA chain\nqa = RetrievalQA.from_chain_type(\n    llm=ChatOpenAI(model=\"gpt-4\"),\n    chain_type=\"stuff\",\n    retriever=retriever,\n)\n\n# Ask questions\nanswer = await qa.ainvoke(\"What is CockroachDB?\")\nprint(answer)\n</code></pre>"},{"location":"getting-started/quick-start/#3-chat-history","title":"3. Chat History","text":"<pre><code>from langchain_cockroachdb import CockroachDBChatMessageHistory\n\nhistory = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=\"cockroachdb://...\",\n)\n\n# Add messages\nhistory.add_user_message(\"Hello!\")\nhistory.add_ai_message(\"Hi! How can I help?\")\n\n# Get history\nmessages = history.messages\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Guide - Tune for your workload</li> <li>Vector Indexes Guide - Optimize query performance</li> <li>API Reference - Full API documentation</li> </ul>"},{"location":"guides/async-vs-sync/","title":"Async vs Sync Guide","text":"<p>Understanding when to use async and sync APIs.</p>"},{"location":"guides/async-vs-sync/#overview","title":"Overview","text":"<p>langchain-cockroachdb provides both async and sync interfaces: - Async (recommended): High-performance, I/O concurrency - Sync: Simple wrapper for scripts and batch jobs</p>"},{"location":"guides/async-vs-sync/#quick-comparison","title":"Quick Comparison","text":"Feature Async Sync Throughput High (100-1000+ req/s) Low (10-50 req/s) I/O Handling Non-blocking Blocking Concurrency Native Limited Code Style <code>async</code>/<code>await</code> Regular Python Best For Web apps, APIs, high load Scripts, batch jobs, simple tools"},{"location":"guides/async-vs-sync/#async-api","title":"Async API","text":""},{"location":"guides/async-vs-sync/#when-to-use","title":"When to Use","text":"<p>\u2705 Web Applications <pre><code># FastAPI, Django Async, etc.\nfrom fastapi import FastAPI\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore\n\napp = FastAPI()\n\n@app.get(\"/search\")\nasync def search(query: str):\n    results = await vectorstore.asimilarity_search(query, k=5)\n    return results\n</code></pre></p> <p>\u2705 High Concurrent Load <pre><code># Handle 100s of requests simultaneously\nasync def handle_many_requests(queries: list[str]):\n    tasks = [\n        vectorstore.asimilarity_search(q, k=5) \n        for q in queries\n    ]\n    results = await asyncio.gather(*tasks)\n    return results\n</code></pre></p> <p>\u2705 Modern LLM APIs <pre><code># OpenAI, Anthropic APIs are async\nasync def rag_pipeline(query: str):\n    # Vector search (async)\n    docs = await vectorstore.asimilarity_search(query, k=5)\n\n    # LLM call (async)\n    response = await llm.ainvoke(docs)\n\n    return response\n</code></pre></p> <p>\u2705 Streaming Applications <pre><code>async def stream_results(query: str):\n    async for doc in vectorstore.astream_search(query):\n        yield doc\n</code></pre></p>"},{"location":"guides/async-vs-sync/#basic-usage","title":"Basic Usage","text":"<pre><code>import asyncio\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\n\nasync def main():\n    # Initialize\n    engine = CockroachDBEngine.from_connection_string(\n        \"cockroachdb://...\"\n    )\n\n    await engine.ainit_vectorstore_table(\n        table_name=\"docs\",\n        vector_dimension=1536,\n    )\n\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"docs\",\n    )\n\n    # Add documents\n    ids = await vectorstore.aadd_texts([\n        \"Document 1\",\n        \"Document 2\",\n    ])\n\n    # Search\n    results = await vectorstore.asimilarity_search(\n        \"query\",\n        k=5\n    )\n\n    # Cleanup\n    await engine.aclose()\n\n# Run\nasyncio.run(main())\n</code></pre>"},{"location":"guides/async-vs-sync/#async-methods","title":"Async Methods","text":"<p>All methods prefixed with <code>a</code>: - <code>aadd_texts()</code> - Add documents - <code>aadd_documents()</code> - Add document objects - <code>asimilarity_search()</code> - Search - <code>asimilarity_search_with_score()</code> - Search with scores - <code>adelete()</code> - Delete documents - <code>aapply_vector_index()</code> - Create index - <code>adrop_vector_index()</code> - Drop index</p>"},{"location":"guides/async-vs-sync/#sync-api","title":"Sync API","text":""},{"location":"guides/async-vs-sync/#when-to-use_1","title":"When to Use","text":"<p>\u2705 Simple Scripts <pre><code># One-off data processing\nfrom langchain_cockroachdb import CockroachDBVectorStore\n\nvectorstore = CockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n)\n\n# No async/await needed\nids = vectorstore.add_texts([\"Doc 1\", \"Doc 2\"])\nresults = vectorstore.similarity_search(\"query\", k=5)\n</code></pre></p> <p>\u2705 Batch Jobs <pre><code># Sequential processing\nfor batch in large_dataset:\n    ids = vectorstore.add_texts(batch)\n    print(f\"Processed {len(ids)} documents\")\n</code></pre></p> <p>\u2705 Interactive Development <pre><code># Jupyter notebooks, REPL\nvectorstore.add_texts([\"Test doc\"])\nresults = vectorstore.similarity_search(\"test\", k=1)\nprint(results)\n</code></pre></p> <p>\u2705 Legacy Code <pre><code># Integrating with existing sync codebase\ndef process_documents(docs: list[str]):\n    # No need to refactor to async\n    return vectorstore.add_texts(docs)\n</code></pre></p>"},{"location":"guides/async-vs-sync/#basic-usage_1","title":"Basic Usage","text":"<pre><code>from langchain_cockroachdb import CockroachDBVectorStore, CockroachDBEngine\n\n# Initialize (sync wrapper handles async internally)\nengine = CockroachDBEngine.from_connection_string(\n    \"cockroachdb://...\"\n)\n\n# Sync API - no async/await\nengine.init_vectorstore_table(\n    table_name=\"docs\",\n    vector_dimension=1536,\n)\n\nvectorstore = CockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n)\n\n# Add documents (sync)\nids = vectorstore.add_texts([\n    \"Document 1\",\n    \"Document 2\",\n])\n\n# Search (sync)\nresults = vectorstore.similarity_search(\"query\", k=5)\n\n# Cleanup\nengine.close()\n</code></pre>"},{"location":"guides/async-vs-sync/#sync-methods","title":"Sync Methods","text":"<p>Same names without <code>a</code> prefix: - <code>add_texts()</code> - Add documents - <code>add_documents()</code> - Add document objects - <code>similarity_search()</code> - Search - <code>similarity_search_with_score()</code> - Search with scores - <code>delete()</code> - Delete documents - <code>apply_vector_index()</code> - Create index - <code>drop_vector_index()</code> - Drop index</p>"},{"location":"guides/async-vs-sync/#performance-comparison","title":"Performance Comparison","text":""},{"location":"guides/async-vs-sync/#throughput-test","title":"Throughput Test","text":"<p>Async: <pre><code>async def async_benchmark():\n    # 100 concurrent searches\n    queries = [\"query\"] * 100\n    start = time.time()\n\n    tasks = [\n        vectorstore.asimilarity_search(q, k=5) \n        for q in queries\n    ]\n    await asyncio.gather(*tasks)\n\n    elapsed = time.time() - start\n    print(f\"Async: {100/elapsed:.0f} queries/sec\")\n\n# Result: ~800 queries/sec\n</code></pre></p> <p>Sync: <pre><code>def sync_benchmark():\n    # 100 sequential searches\n    queries = [\"query\"] * 100\n    start = time.time()\n\n    for q in queries:\n        vectorstore.similarity_search(q, k=5)\n\n    elapsed = time.time() - start\n    print(f\"Sync: {100/elapsed:.0f} queries/sec\")\n\n# Result: ~40 queries/sec\n</code></pre></p> <p>Result: Async is 20x faster for concurrent operations.</p>"},{"location":"guides/async-vs-sync/#why-async-is-faster","title":"Why Async is Faster","text":"<p>Sync (blocking): <pre><code>Query 1: [DB wait] [process] \u2500\u2500\u2500\u2500\u2510\nQuery 2:                          [DB wait] [process] \u2500\u2500\u2500\u2500\u2510\nQuery 3:                                                  [DB wait] [process]\nTotal: 300ms\n</code></pre></p> <p>Async (non-blocking): <pre><code>Query 1: [DB wait] [process]\nQuery 2: [DB wait] [process]\nQuery 3: [DB wait] [process]\n         \u25b2 All waiting simultaneously\nTotal: 100ms\n</code></pre></p>"},{"location":"guides/async-vs-sync/#hybrid-approach","title":"Hybrid Approach","text":""},{"location":"guides/async-vs-sync/#async-function-with-sync-wrapper","title":"Async Function with Sync Wrapper","text":"<pre><code># Define async logic\nasync def complex_rag_pipeline(query: str) -&gt; str:\n    docs = await vectorstore.asimilarity_search(query, k=5)\n    response = await llm.ainvoke(docs)\n    return response.content\n\n# Provide sync wrapper for simple use\ndef rag(query: str) -&gt; str:\n    \"\"\"Sync wrapper for RAG pipeline.\"\"\"\n    return asyncio.run(complex_rag_pipeline(query))\n\n# Use sync wrapper in scripts\nresult = rag(\"What is CockroachDB?\")\nprint(result)\n</code></pre>"},{"location":"guides/async-vs-sync/#run-async-from-sync","title":"Run Async from Sync","text":"<pre><code>import asyncio\n\ndef sync_function():\n    # Run async code from sync context\n    result = asyncio.run(vectorstore.asimilarity_search(\"query\", k=5))\n    return result\n</code></pre>"},{"location":"guides/async-vs-sync/#use-both-apis","title":"Use Both APIs","text":"<pre><code># Async for web endpoints\n@app.get(\"/search\")\nasync def search(query: str):\n    return await async_vectorstore.asimilarity_search(query, k=5)\n\n# Sync for admin scripts\ndef backfill_data(documents: list):\n    sync_vectorstore.add_documents(documents)\n</code></pre>"},{"location":"guides/async-vs-sync/#common-patterns","title":"Common Patterns","text":""},{"location":"guides/async-vs-sync/#web-application-fastapi","title":"Web Application (FastAPI)","text":"<pre><code>from fastapi import FastAPI\nfrom langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\n\napp = FastAPI()\n\n# Initialize at startup\n@app.on_event(\"startup\")\nasync def startup():\n    global vectorstore\n    engine = CockroachDBEngine.from_connection_string(\n        os.getenv(\"COCKROACHDB_URL\")\n    )\n    vectorstore = AsyncCockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"docs\",\n    )\n\n# Async endpoints\n@app.get(\"/search\")\nasync def search(query: str, k: int = 5):\n    results = await vectorstore.asimilarity_search(query, k=k)\n    return {\"results\": [doc.page_content for doc in results]}\n\n@app.post(\"/add\")\nasync def add_document(content: str):\n    ids = await vectorstore.aadd_texts([content])\n    return {\"id\": ids[0]}\n</code></pre>"},{"location":"guides/async-vs-sync/#data-migration-script","title":"Data Migration Script","text":"<pre><code>from langchain_cockroachdb import CockroachDBVectorStore\n\ndef migrate_documents(source_file: str):\n    \"\"\"Simple sync script for one-time migration.\"\"\"\n    vectorstore = CockroachDBVectorStore(\n        engine=engine,\n        embeddings=embeddings,\n        collection_name=\"docs\",\n    )\n\n    # Read documents\n    with open(source_file) as f:\n        docs = f.readlines()\n\n    # Process in batches\n    batch_size = 100\n    for i in range(0, len(docs), batch_size):\n        batch = docs[i:i+batch_size]\n        ids = vectorstore.add_texts(batch)\n        print(f\"Migrated batch {i//batch_size + 1}: {len(ids)} docs\")\n\n# Run\nmigrate_documents(\"documents.txt\")\n</code></pre>"},{"location":"guides/async-vs-sync/#jupyter-notebook","title":"Jupyter Notebook","text":"<pre><code># Sync API works well in notebooks\nfrom langchain_cockroachdb import CockroachDBVectorStore\n\nvectorstore = CockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n)\n\n# Interactive exploration\nvectorstore.add_texts([\"Test document\"])\nresults = vectorstore.similarity_search(\"test\", k=1)\nprint(results[0].page_content)\n</code></pre>"},{"location":"guides/async-vs-sync/#best-practices","title":"Best Practices","text":""},{"location":"guides/async-vs-sync/#1-choose-based-on-context","title":"1. Choose Based on Context","text":"Context Use Why Web API Async High concurrency CLI Tool Sync Simplicity Data Pipeline Async Better throughput Jupyter Sync Easier debugging"},{"location":"guides/async-vs-sync/#2-dont-mix-in-same-function","title":"2. Don't Mix in Same Function","text":"<pre><code># Bad: Mixing async and sync\nasync def bad_example():\n    await vectorstore.aadd_texts([\"doc1\"])\n    results = vectorstore.similarity_search(\"query\", k=5)  # Wrong!\n\n# Good: Use one or the other\nasync def good_async_example():\n    await vectorstore.aadd_texts([\"doc1\"])\n    results = await vectorstore.asimilarity_search(\"query\", k=5)\n\ndef good_sync_example():\n    vectorstore.add_texts([\"doc1\"])\n    results = vectorstore.similarity_search(\"query\", k=5)\n</code></pre>"},{"location":"guides/async-vs-sync/#3-async-all-the-way","title":"3. Async All the Way","text":"<pre><code># If using async, use it throughout\nasync def full_async_pipeline(query: str):\n    # All async\n    docs = await vectorstore.asimilarity_search(query, k=5)\n    response = await llm.ainvoke(docs)\n    await log_to_db(query, response)\n    return response\n</code></pre>"},{"location":"guides/async-vs-sync/#4-close-connections-properly","title":"4. Close Connections Properly","text":"<pre><code># Async\ntry:\n    await vectorstore.aadd_texts(texts)\nfinally:\n    await engine.aclose()\n\n# Sync\ntry:\n    vectorstore.add_texts(texts)\nfinally:\n    engine.close()\n</code></pre>"},{"location":"guides/async-vs-sync/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/async-vs-sync/#runtimeerror-asynciorun-cannot-be-called-from-a-running-event-loop","title":"\"RuntimeError: asyncio.run() cannot be called from a running event loop\"","text":"<p>You're trying to use <code>asyncio.run()</code> inside an async function:</p> <pre><code># Wrong\nasync def my_function():\n    result = asyncio.run(vectorstore.asimilarity_search(\"query\"))\n\n# Right\nasync def my_function():\n    result = await vectorstore.asimilarity_search(\"query\")\n</code></pre>"},{"location":"guides/async-vs-sync/#slow-performance-with-sync-api","title":"Slow Performance with Sync API","text":"<p>Consider switching to async if you have: - Multiple concurrent operations - I/O-bound workload - Web application with many users</p> <pre><code># Before (slow)\nfor query in queries:\n    vectorstore.similarity_search(query, k=5)\n\n# After (fast)\nasync def process_queries(queries):\n    tasks = [\n        vectorstore.asimilarity_search(q, k=5) \n        for q in queries\n    ]\n    return await asyncio.gather(*tasks)\n</code></pre>"},{"location":"guides/async-vs-sync/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration - Optimize connection pools</li> <li>Examples - See both APIs in action</li> <li>API Reference - Full method documentation</li> </ul>"},{"location":"guides/chat-history/","title":"Chat History Guide","text":"<p>Persist conversation history in CockroachDB for chatbots and conversational AI applications.</p>"},{"location":"guides/chat-history/#overview","title":"Overview","text":"<p><code>CockroachDBChatMessageHistory</code> provides persistent storage for conversation messages with: - Session-based organization - Automatic table creation - LangChain integration - Thread isolation</p>"},{"location":"guides/chat-history/#basic-usage","title":"Basic Usage","text":""},{"location":"guides/chat-history/#initialization","title":"Initialization","text":"<pre><code>from langchain_cockroachdb import CockroachDBChatMessageHistory\n\n# Create message history for a session\nhistory = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=\"cockroachdb://user:pass@host:26257/db\",\n)\n</code></pre>"},{"location":"guides/chat-history/#adding-messages","title":"Adding Messages","text":"<pre><code># Add user message\nhistory.add_user_message(\"Hello! How are you?\")\n\n# Add AI response\nhistory.add_ai_message(\"I'm doing well, thank you! How can I help you today?\")\n</code></pre>"},{"location":"guides/chat-history/#retrieving-messages","title":"Retrieving Messages","text":"<pre><code># Get all messages in session\nmessages = history.messages\n\nfor msg in messages:\n    print(f\"{msg.type}: {msg.content}\")\n</code></pre>"},{"location":"guides/chat-history/#clearing-history","title":"Clearing History","text":"<pre><code># Clear specific session\nhistory.clear()\n\n# Or create new history object\nhistory = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=connection_string,\n)\nhistory.clear()\n</code></pre>"},{"location":"guides/chat-history/#table-management","title":"Table Management","text":""},{"location":"guides/chat-history/#create-table","title":"Create Table","text":"<pre><code># Table is created automatically on first use\n# Or create explicitly:\nawait CockroachDBChatMessageHistory.acreate_tables(connection_string)\n</code></pre> <p>Default table schema: <pre><code>CREATE TABLE IF NOT EXISTS message_store (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    session_id TEXT NOT NULL,\n    message JSONB NOT NULL,\n    created_at TIMESTAMPTZ DEFAULT now()\n);\n\nCREATE INDEX ON message_store (session_id);\n</code></pre></p>"},{"location":"guides/chat-history/#custom-table-name","title":"Custom Table Name","text":"<pre><code>history = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=connection_string,\n    table_name=\"my_chat_history\",\n)\n</code></pre>"},{"location":"guides/chat-history/#drop-table","title":"Drop Table","text":"<pre><code>await CockroachDBChatMessageHistory.adrop_tables(\n    connection_string,\n    table_name=\"message_store\"\n)\n</code></pre>"},{"location":"guides/chat-history/#integration-with-langchain","title":"Integration with LangChain","text":""},{"location":"guides/chat-history/#with-conversation-chains","title":"With Conversation Chains","text":"<pre><code>from langchain.chains import ConversationChain\nfrom langchain.memory import ConversationBufferMemory\nfrom langchain_openai import ChatOpenAI\nfrom langchain_cockroachdb import CockroachDBChatMessageHistory\n\n# Create message history\nhistory = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=connection_string,\n)\n\n# Create memory\nmemory = ConversationBufferMemory(\n    chat_memory=history,\n    return_messages=True,\n)\n\n# Create chain\nllm = ChatOpenAI()\nconversation = ConversationChain(\n    llm=llm,\n    memory=memory,\n    verbose=True,\n)\n\n# Chat\nresponse = conversation.predict(input=\"Hello!\")\nprint(response)\n\n# History is automatically saved to CockroachDB\n</code></pre>"},{"location":"guides/chat-history/#with-lcel-chains","title":"With LCEL Chains","text":"<pre><code>from langchain_core.runnables.history import RunnableWithMessageHistory\nfrom langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder\nfrom langchain_openai import ChatOpenAI\n\n# Define prompt\nprompt = ChatPromptTemplate.from_messages([\n    (\"system\", \"You are a helpful assistant.\"),\n    MessagesPlaceholder(variable_name=\"history\"),\n    (\"human\", \"{input}\"),\n])\n\n# Create chain\nchain = prompt | ChatOpenAI()\n\n# Wrap with message history\nchain_with_history = RunnableWithMessageHistory(\n    chain,\n    lambda session_id: CockroachDBChatMessageHistory(\n        session_id=session_id,\n        connection_string=connection_string,\n    ),\n    input_messages_key=\"input\",\n    history_messages_key=\"history\",\n)\n\n# Use with session\nresponse = chain_with_history.invoke(\n    {\"input\": \"Hello!\"},\n    config={\"configurable\": {\"session_id\": \"user-123\"}},\n)\nprint(response.content)\n</code></pre>"},{"location":"guides/chat-history/#with-conversationbufferwindowmemory","title":"With ConversationBufferWindowMemory","text":"<pre><code>from langchain.memory import ConversationBufferWindowMemory\n\n# Keep only last 5 messages in memory\nmemory = ConversationBufferWindowMemory(\n    k=5,  # Last 5 exchanges\n    chat_memory=CockroachDBChatMessageHistory(\n        session_id=\"user-123\",\n        connection_string=connection_string,\n    ),\n    return_messages=True,\n)\n</code></pre>"},{"location":"guides/chat-history/#multi-user-applications","title":"Multi-User Applications","text":""},{"location":"guides/chat-history/#per-user-sessions","title":"Per-User Sessions","text":"<pre><code>def get_session_history(user_id: str) -&gt; CockroachDBChatMessageHistory:\n    \"\"\"Get chat history for a specific user.\"\"\"\n    return CockroachDBChatMessageHistory(\n        session_id=f\"user-{user_id}\",\n        connection_string=connection_string,\n    )\n\n# Use for different users\nuser_1_history = get_session_history(\"user-123\")\nuser_2_history = get_session_history(\"user-456\")\n\n# Each user has isolated conversation\nuser_1_history.add_user_message(\"What's the weather?\")\nuser_2_history.add_user_message(\"Tell me a joke\")\n</code></pre>"},{"location":"guides/chat-history/#multiple-conversations-per-user","title":"Multiple Conversations Per User","text":"<pre><code>def get_conversation_history(user_id: str, conversation_id: str):\n    \"\"\"Get specific conversation for a user.\"\"\"\n    return CockroachDBChatMessageHistory(\n        session_id=f\"{user_id}:{conversation_id}\",\n        connection_string=connection_string,\n    )\n\n# User can have multiple conversations\nmain_chat = get_conversation_history(\"user-123\", \"main\")\nsupport_chat = get_conversation_history(\"user-123\", \"support\")\n</code></pre>"},{"location":"guides/chat-history/#advanced-features","title":"Advanced Features","text":""},{"location":"guides/chat-history/#message-metadata","title":"Message Metadata","text":"<pre><code>from langchain_core.messages import HumanMessage, AIMessage\n\n# Add messages with metadata\nhistory.add_message(\n    HumanMessage(\n        content=\"What's the capital of France?\",\n        additional_kwargs={\"timestamp\": \"2024-01-15T10:30:00\"}\n    )\n)\n\nhistory.add_message(\n    AIMessage(\n        content=\"The capital of France is Paris.\",\n        additional_kwargs={\"model\": \"gpt-4\", \"tokens\": 12}\n    )\n)\n</code></pre>"},{"location":"guides/chat-history/#async-operations","title":"Async Operations","text":"<pre><code># For async applications\nasync def handle_chat(user_id: str, message: str):\n    history = CockroachDBChatMessageHistory(\n        session_id=f\"user-{user_id}\",\n        connection_string=connection_string,\n    )\n\n    # Add user message\n    history.add_user_message(message)\n\n    # Process with LLM (async)\n    response = await llm.ainvoke(message)\n\n    # Add AI response\n    history.add_ai_message(response.content)\n\n    return response.content\n</code></pre>"},{"location":"guides/chat-history/#query-history","title":"Query History","text":"<pre><code># Get recent messages from database\nasync with engine.engine.connect() as conn:\n    from sqlalchemy import text\n\n    result = await conn.execute(\n        text(\"\"\"\n            SELECT session_id, message, created_at\n            FROM message_store\n            WHERE session_id = :session_id\n            ORDER BY created_at DESC\n            LIMIT 10\n        \"\"\"),\n        {\"session_id\": \"user-123\"}\n    )\n\n    for row in result:\n        print(f\"{row.created_at}: {row.message}\")\n</code></pre>"},{"location":"guides/chat-history/#message-types","title":"Message Types","text":""},{"location":"guides/chat-history/#supported-types","title":"Supported Types","text":"<pre><code>from langchain_core.messages import (\n    HumanMessage,\n    AIMessage,\n    SystemMessage,\n    FunctionMessage,\n    ToolMessage,\n)\n\n# Human message\nhistory.add_message(HumanMessage(content=\"Hello\"))\n\n# AI message\nhistory.add_message(AIMessage(content=\"Hi there!\"))\n\n# System message\nhistory.add_message(SystemMessage(content=\"You are a helpful assistant\"))\n\n# Function/Tool messages\nhistory.add_message(FunctionMessage(\n    content=\"Weather: 72\u00b0F, Sunny\",\n    name=\"get_weather\"\n))\n</code></pre>"},{"location":"guides/chat-history/#session-management","title":"Session Management","text":""},{"location":"guides/chat-history/#list-all-sessions","title":"List All Sessions","text":"<pre><code>async def list_sessions():\n    \"\"\"Get all active session IDs.\"\"\"\n    async with engine.engine.connect() as conn:\n        from sqlalchemy import text\n\n        result = await conn.execute(\n            text(\"\"\"\n                SELECT DISTINCT session_id \n                FROM message_store\n                ORDER BY MAX(created_at) DESC\n            \"\"\")\n        )\n\n        return [row[0] for row in result]\n\nsessions = await list_sessions()\nprint(f\"Active sessions: {sessions}\")\n</code></pre>"},{"location":"guides/chat-history/#delete-old-sessions","title":"Delete Old Sessions","text":"<pre><code>async def cleanup_old_sessions(days: int = 30):\n    \"\"\"Delete sessions older than N days.\"\"\"\n    async with engine.engine.connect() as conn:\n        from sqlalchemy import text\n\n        await conn.execute(\n            text(\"\"\"\n                DELETE FROM message_store\n                WHERE created_at &lt; NOW() - INTERVAL ':days days'\n            \"\"\"),\n            {\"days\": days}\n        )\n        await conn.commit()\n\nawait cleanup_old_sessions(30)\n</code></pre>"},{"location":"guides/chat-history/#best-practices","title":"Best Practices","text":""},{"location":"guides/chat-history/#1-use-descriptive-session-ids","title":"1. Use Descriptive Session IDs","text":"<pre><code># Good: Clear, hierarchical\nsession_id = f\"{user_id}:{conversation_type}:{conversation_id}\"\nsession_id = \"user-123:support:ticket-456\"\n\n# Bad: Opaque\nsession_id = \"abc123xyz\"\n</code></pre>"},{"location":"guides/chat-history/#2-clean-up-old-sessions","title":"2. Clean Up Old Sessions","text":"<pre><code># Periodic cleanup\nimport asyncio\n\nasync def periodic_cleanup():\n    while True:\n        await cleanup_old_sessions(days=30)\n        await asyncio.sleep(86400)  # Daily\n</code></pre>"},{"location":"guides/chat-history/#3-handle-errors-gracefully","title":"3. Handle Errors Gracefully","text":"<pre><code>try:\n    history.add_user_message(message)\nexcept Exception as e:\n    print(f\"Failed to save message: {e}\")\n    # Continue without history\n</code></pre>"},{"location":"guides/chat-history/#4-use-connection-pooling","title":"4. Use Connection Pooling","text":"<pre><code># Reuse engine across sessions\nfrom langchain_cockroachdb import CockroachDBEngine\n\nengine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=10,\n)\n\n# Pass engine connection string to history\nhistory = CockroachDBChatMessageHistory(\n    session_id=\"user-123\",\n    connection_string=connection_string,\n)\n</code></pre>"},{"location":"guides/chat-history/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/chat-history/#table-not-created","title":"Table Not Created","text":"<pre><code># Explicitly create tables\nawait CockroachDBChatMessageHistory.acreate_tables(connection_string)\n</code></pre>"},{"location":"guides/chat-history/#messages-not-persisting","title":"Messages Not Persisting","text":"<p>Check connection: <pre><code># Test connection\nasync with engine.engine.connect() as conn:\n    from sqlalchemy import text\n    result = await conn.execute(text(\"SELECT 1\"))\n    print(result.scalar())\n</code></pre></p>"},{"location":"guides/chat-history/#slow-queries","title":"Slow Queries","text":"<p>Create index on session_id: <pre><code>CREATE INDEX IF NOT EXISTS idx_session_created \nON message_store (session_id, created_at DESC);\n</code></pre></p>"},{"location":"guides/chat-history/#examples","title":"Examples","text":""},{"location":"guides/chat-history/#complete-chatbot","title":"Complete Chatbot","text":"<pre><code>from langchain_cockroachdb import CockroachDBChatMessageHistory\nfrom langchain.memory import ConversationBufferMemory\nfrom langchain.chains import ConversationChain\nfrom langchain_openai import ChatOpenAI\n\ndef create_chatbot(user_id: str):\n    \"\"\"Create chatbot with persistent history.\"\"\"\n    history = CockroachDBChatMessageHistory(\n        session_id=f\"user-{user_id}\",\n        connection_string=connection_string,\n    )\n\n    memory = ConversationBufferMemory(\n        chat_memory=history,\n        return_messages=True,\n    )\n\n    return ConversationChain(\n        llm=ChatOpenAI(model=\"gpt-4\"),\n        memory=memory,\n    )\n\n# Use chatbot\nbot = create_chatbot(\"user-123\")\n\n# First conversation\nresponse1 = bot.predict(input=\"My name is Alice\")\n# AI: \"Nice to meet you, Alice!\"\n\n# Later conversation (history is loaded)\nresponse2 = bot.predict(input=\"What's my name?\")\n# AI: \"Your name is Alice.\"\n</code></pre>"},{"location":"guides/chat-history/#multi-turn-dialog","title":"Multi-Turn Dialog","text":"<pre><code>async def handle_conversation(user_id: str, messages: list[str]):\n    \"\"\"Process multi-turn conversation.\"\"\"\n    history = CockroachDBChatMessageHistory(\n        session_id=f\"user-{user_id}\",\n        connection_string=connection_string,\n    )\n\n    llm = ChatOpenAI()\n\n    for user_msg in messages:\n        # Add user message\n        history.add_user_message(user_msg)\n\n        # Get context\n        context = history.messages\n\n        # Generate response\n        response = await llm.ainvoke(context)\n\n        # Save AI response\n        history.add_ai_message(response.content)\n\n        print(f\"User: {user_msg}\")\n        print(f\"AI: {response.content}\\n\")\n\n# Use\nawait handle_conversation(\"user-123\", [\n    \"Hello!\",\n    \"What can you help me with?\",\n    \"Tell me about CockroachDB\",\n])\n</code></pre>"},{"location":"guides/chat-history/#next-steps","title":"Next Steps","text":"<ul> <li>Vector Store - For RAG applications</li> <li>Configuration - Optimize performance</li> <li>API Reference - Full API documentation</li> </ul>"},{"location":"guides/hybrid-search/","title":"Hybrid Search Guide","text":"<p>Combine full-text search with vector similarity for best search results.</p>"},{"location":"guides/hybrid-search/#overview","title":"Overview","text":"<p>Hybrid search combines: - Full-Text Search (FTS): Keyword matching using PostgreSQL's TSVECTOR - Vector Search: Semantic similarity using embeddings - Score Fusion: Merges results using weighted sum or RRF</p> <p>Benefits: - Better recall (finds more relevant results) - Handles both exact keywords and semantic meaning - Robust to query formulation</p>"},{"location":"guides/hybrid-search/#configuration","title":"Configuration","text":""},{"location":"guides/hybrid-search/#enable-hybrid-search","title":"Enable Hybrid Search","text":"<pre><code>from langchain_cockroachdb import (\n    AsyncCockroachDBVectorStore,\n    CockroachDBEngine,\n    HybridSearchConfig,\n)\n\nengine = CockroachDBEngine.from_connection_string(connection_string)\n\n# Initialize table with FTS support\nawait engine.ainit_vectorstore_table(\n    table_name=\"documents\",\n    vector_dimension=1536,\n)\n\n# Create vector store with hybrid search\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.5,      # Weight for vector search (0-1)\n    fts_weight=0.5,         # Weight for FTS (0-1)\n    fusion_type=\"weighted_sum\",  # or \"reciprocal_rank_fusion\"\n)\n\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"documents\",\n    hybrid_search_config=hybrid_config,\n)\n</code></pre>"},{"location":"guides/hybrid-search/#create-fts-index","title":"Create FTS Index","text":"<pre><code># Create TSVECTOR column and GIN index\nawait vectorstore.aapply_hybrid_search()\n</code></pre> <p>This creates: <pre><code>-- Add tsvector column\nALTER TABLE documents \nADD COLUMN content_tsvector TSVECTOR \nGENERATED ALWAYS AS (to_tsvector('english', content)) STORED;\n\n-- Create GIN index\nCREATE INDEX ON documents USING GIN (content_tsvector);\n</code></pre></p>"},{"location":"guides/hybrid-search/#fusion-strategies","title":"Fusion Strategies","text":""},{"location":"guides/hybrid-search/#weighted-sum","title":"Weighted Sum","text":"<p>Combines scores with weights:</p> <pre><code>hybrid_config = HybridSearchConfig(\n    vector_weight=0.7,      # Emphasize semantic similarity\n    fts_weight=0.3,         # Some weight for keywords\n    fusion_type=\"weighted_sum\",\n)\n</code></pre> <p>Formula: <pre><code>final_score = (vector_weight * vector_score) + (fts_weight * fts_score)\n</code></pre></p> <p>Use when: - You trust one method more than the other - Clear preference for semantic vs keyword matching</p>"},{"location":"guides/hybrid-search/#reciprocal-rank-fusion-rrf","title":"Reciprocal Rank Fusion (RRF)","text":"<p>Combines based on rank position:</p> <pre><code>hybrid_config = HybridSearchConfig(\n    fusion_type=\"reciprocal_rank_fusion\",\n    rrf_k=60,  # RRF constant (higher = less emphasis on top ranks)\n)\n</code></pre> <p>Formula: <pre><code>score(doc) = sum(1 / (k + rank(doc, method))) for each method\n</code></pre></p> <p>Use when: - No clear preference between methods - Want balanced results - Popular in academic research</p>"},{"location":"guides/hybrid-search/#searching","title":"Searching","text":""},{"location":"guides/hybrid-search/#basic-hybrid-search","title":"Basic Hybrid Search","text":"<pre><code># Performs both FTS and vector search, then fuses results\nresults = await vectorstore.ahybrid_search(\n    \"distributed databases performance\",\n    k=10\n)\n\nfor doc in results:\n    print(f\"Content: {doc.page_content}\")\n    print(f\"Metadata: {doc.metadata}\")\n</code></pre>"},{"location":"guides/hybrid-search/#with-scores","title":"With Scores","text":"<pre><code>results = await vectorstore.ahybrid_search_with_score(\n    \"CockroachDB scalability\",\n    k=10\n)\n\nfor doc, score in results:\n    print(f\"Score: {score:.4f} - {doc.page_content[:100]}\")\n</code></pre>"},{"location":"guides/hybrid-search/#with-filters","title":"With Filters","text":"<pre><code># Apply metadata filters\nresults = await vectorstore.ahybrid_search(\n    \"database query\",\n    k=10,\n    filter={\"category\": \"tech\", \"year\": {\"$gte\": 2023}}\n)\n</code></pre>"},{"location":"guides/hybrid-search/#tuning-weights","title":"Tuning Weights","text":""},{"location":"guides/hybrid-search/#emphasize-semantic-search","title":"Emphasize Semantic Search","text":"<pre><code># Good for: Conceptual queries, synonym matching\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.8,\n    fts_weight=0.2,\n)\n</code></pre> <p>Example queries: - \"What's a good scalable database?\" (no keyword \"CockroachDB\") - \"distributed SQL solutions\" (semantic understanding)</p>"},{"location":"guides/hybrid-search/#emphasize-keyword-search","title":"Emphasize Keyword Search","text":"<pre><code># Good for: Exact term matching, technical queries\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.3,\n    fts_weight=0.7,\n)\n</code></pre> <p>Example queries: - \"CockroachDB SERIALIZABLE isolation\" (exact terms) - \"error code 40001\" (precise matching)</p>"},{"location":"guides/hybrid-search/#balanced","title":"Balanced","text":"<pre><code># Good for: General purpose, unknown query types\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.5,\n    fts_weight=0.5,\n)\n</code></pre>"},{"location":"guides/hybrid-search/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"guides/hybrid-search/#language-configuration","title":"Language Configuration","text":"<pre><code># FTS supports multiple languages\nawait vectorstore.aapply_hybrid_search(language=\"english\")\n\n# Other languages: spanish, french, german, etc.\nawait vectorstore.aapply_hybrid_search(language=\"spanish\")\n</code></pre>"},{"location":"guides/hybrid-search/#custom-tsvector-column","title":"Custom TSVECTOR Column","text":"<pre><code># Use different text column for FTS\nhybrid_config = HybridSearchConfig(\n    tsvector_column=\"title_tsvector\",  # Index title instead of content\n)\n</code></pre>"},{"location":"guides/hybrid-search/#fetch-more-candidates","title":"Fetch More Candidates","text":"<pre><code># Fetch more results from each method before fusion\nresults = await vectorstore.ahybrid_search(\n    \"query\",\n    k=10,            # Return top 10\n    fetch_k=50,      # But fetch top 50 from each method first\n)\n</code></pre>"},{"location":"guides/hybrid-search/#performance-considerations","title":"Performance Considerations","text":""},{"location":"guides/hybrid-search/#index-both-types","title":"Index Both Types","text":"<pre><code># Create vector index\nfrom langchain_cockroachdb import CSPANNIndex\nvector_index = CSPANNIndex()\nawait vectorstore.aapply_vector_index(vector_index)\n\n# Create FTS index\nawait vectorstore.aapply_hybrid_search()\n</code></pre> <p>Result: Fast hybrid search with both indexes</p>"},{"location":"guides/hybrid-search/#batch-queries","title":"Batch Queries","text":"<pre><code># For multiple queries, reuse connection\nqueries = [\"query1\", \"query2\", \"query3\"]\nall_results = []\n\nfor query in queries:\n    results = await vectorstore.ahybrid_search(query, k=5)\n    all_results.append(results)\n</code></pre>"},{"location":"guides/hybrid-search/#comparison-vector-vs-fts-vs-hybrid","title":"Comparison: Vector vs FTS vs Hybrid","text":""},{"location":"guides/hybrid-search/#vector-search-only","title":"Vector Search Only","text":"<pre><code>results = await vectorstore.asimilarity_search(\n    \"scalable databases\", k=10\n)\n</code></pre> <p>Strengths: - Understands semantic meaning - Handles synonyms and paraphrasing - Works across languages (with multilingual embeddings)</p> <p>Weaknesses: - May miss exact keyword matches - Embedding quality matters - Slower for very large datasets</p>"},{"location":"guides/hybrid-search/#fts-only","title":"FTS Only","text":"<pre><code># (Hypothetical FTS-only method)\nresults = await vectorstore.afts_search(\n    \"CockroachDB SERIALIZABLE\", k=10\n)\n</code></pre> <p>Strengths: - Fast exact keyword matching - No embedding computation needed - Good for technical terms</p> <p>Weaknesses: - No semantic understanding - Misses synonyms - Query formulation matters</p>"},{"location":"guides/hybrid-search/#hybrid-best-of-both","title":"Hybrid (Best of Both)","text":"<pre><code>results = await vectorstore.ahybrid_search(\n    \"scalable database systems\", k=10\n)\n</code></pre> <p>Strengths: - Combines semantic + keyword matching - More robust results - Better recall</p> <p>Weaknesses: - Slightly slower (two searches) - More complex configuration - Requires both indexes</p>"},{"location":"guides/hybrid-search/#example-use-cases","title":"Example Use Cases","text":""},{"location":"guides/hybrid-search/#documentation-search","title":"Documentation Search","text":"<pre><code># Users might search exact error codes or concepts\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.4,\n    fts_weight=0.6,  # Prefer exact matches\n)\n</code></pre>"},{"location":"guides/hybrid-search/#e-commerce-product-search","title":"E-commerce Product Search","text":"<pre><code># Balance between product names and descriptions\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.5,\n    fts_weight=0.5,\n)\n</code></pre>"},{"location":"guides/hybrid-search/#academic-paper-search","title":"Academic Paper Search","text":"<pre><code># Semantic understanding important\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.7,\n    fts_weight=0.3,\n)\n</code></pre>"},{"location":"guides/hybrid-search/#code-search","title":"Code Search","text":"<pre><code># Exact function/variable names matter\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.3,\n    fts_weight=0.7,\n)\n</code></pre>"},{"location":"guides/hybrid-search/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/hybrid-search/#fts-not-working","title":"FTS Not Working","text":"<p>Check if tsvector column and index exist: <pre><code>async with engine.engine.connect() as conn:\n    from sqlalchemy import text\n    result = await conn.execute(\n        text(\"\"\"\n            SELECT column_name \n            FROM information_schema.columns \n            WHERE table_name = 'documents' \n            AND column_name LIKE '%tsvector%'\n        \"\"\")\n    )\n    print(list(result))\n</code></pre></p>"},{"location":"guides/hybrid-search/#poor-hybrid-results","title":"Poor Hybrid Results","text":"<p>Try different fusion strategies: <pre><code># Try RRF instead of weighted sum\nhybrid_config = HybridSearchConfig(\n    fusion_type=\"reciprocal_rank_fusion\",\n)\n</code></pre></p> <p>Or adjust weights: <pre><code># If semantic search alone works better, increase vector weight\nhybrid_config = HybridSearchConfig(\n    vector_weight=0.8,\n    fts_weight=0.2,\n)\n</code></pre></p>"},{"location":"guides/hybrid-search/#next-steps","title":"Next Steps","text":"<ul> <li>Vector Indexes - Optimize vector search</li> <li>Configuration - Tune performance</li> <li>API Reference - Full API details</li> </ul>"},{"location":"guides/vector-indexes/","title":"Vector Indexes Guide","text":"<p>Optimize query performance with CockroachDB's C-SPANN vector indexes.</p>"},{"location":"guides/vector-indexes/#overview","title":"Overview","text":"<p>CockroachDB uses C-SPANN (CockroachDB SPANN - Scalable Partitioned Approximate Nearest Neighbors) for vector indexing. This algorithm is optimized for distributed databases and provides:</p> <ul> <li>Real-time indexing (no rebuild needed)</li> <li>Automatic sharding and rebalancing</li> <li>Fresh results (queries see latest data)</li> <li>Distributed query execution</li> </ul>"},{"location":"guides/vector-indexes/#when-to-use-indexes","title":"When to Use Indexes","text":"<p>Use indexes when: - \u2705 Dataset &gt; 10,000 vectors - \u2705 Query latency is critical - \u2705 Frequent searches on same dataset - \u2705 Multi-tenant with prefix columns</p> <p>Skip indexes when: - \u274c Dataset &lt; 1,000 vectors - \u274c Mostly writes, few reads - \u274c Data changes constantly - \u274c Acceptable to scan all vectors</p>"},{"location":"guides/vector-indexes/#basic-index-creation","title":"Basic Index Creation","text":""},{"location":"guides/vector-indexes/#create-index","title":"Create Index","text":"<pre><code>from langchain_cockroachdb import CSPANNIndex\n\n# Create with defaults\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n</code></pre> <p>This creates: <pre><code>CREATE VECTOR INDEX ON documents (embedding);\n</code></pre></p>"},{"location":"guides/vector-indexes/#specify-distance-strategy","title":"Specify Distance Strategy","text":"<pre><code>from langchain_cockroachdb import CSPANNIndex, DistanceStrategy\n\n# Cosine similarity (default)\nindex = CSPANNIndex(distance_strategy=DistanceStrategy.COSINE)\nawait vectorstore.aapply_vector_index(index)\n\n# Euclidean distance (L2)\nindex = CSPANNIndex(distance_strategy=DistanceStrategy.EUCLIDEAN)\nawait vectorstore.aapply_vector_index(index)\n\n# Inner product\nindex = CSPANNIndex(distance_strategy=DistanceStrategy.INNER_PRODUCT)\nawait vectorstore.aapply_vector_index(index)\n</code></pre>"},{"location":"guides/vector-indexes/#advanced-index-configuration","title":"Advanced Index Configuration","text":""},{"location":"guides/vector-indexes/#partition-sizes","title":"Partition Sizes","text":"<p>Control how vectors are partitioned:</p> <pre><code>index = CSPANNIndex(\n    distance_strategy=DistanceStrategy.COSINE,\n    min_partition_size=10,    # Minimum vectors per partition\n    max_partition_size=100,   # Maximum vectors per partition\n)\nawait vectorstore.aapply_vector_index(index)\n</code></pre> <p>Guidelines: - Smaller partitions = higher accuracy, slower queries - Larger partitions = faster queries, lower accuracy - Default (None) = CockroachDB chooses optimal size</p>"},{"location":"guides/vector-indexes/#custom-index-name","title":"Custom Index Name","text":"<pre><code>index = CSPANNIndex(name=\"my_custom_index_name\")\nawait vectorstore.aapply_vector_index(index)\n</code></pre>"},{"location":"guides/vector-indexes/#multi-tenant-indexes","title":"Multi-Tenant Indexes","text":""},{"location":"guides/vector-indexes/#prefix-columns","title":"Prefix Columns","text":"<p>Create indexes with prefix columns for tenant isolation:</p> <pre><code># Assume table has tenant_id column as first column\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n</code></pre> <p>CockroachDB will automatically use prefix columns if: 1. Table has non-vector columns before embedding column 2. Query filters on those columns</p> <p>Example: <pre><code>-- Table structure\nCREATE TABLE documents (\n    tenant_id UUID,\n    collection_id TEXT,\n    id UUID PRIMARY KEY,\n    content TEXT,\n    embedding VECTOR(1536),\n    metadata JSONB\n);\n\n-- Index with prefix columns\nCREATE VECTOR INDEX ON documents (tenant_id, collection_id, embedding);\n</code></pre></p> <p>Benefits: - Each tenant's vectors are colocated - Filters on prefix columns use index efficiently - Better performance for multi-tenant apps</p>"},{"location":"guides/vector-indexes/#query-time-tuning","title":"Query-Time Tuning","text":""},{"location":"guides/vector-indexes/#beam-size","title":"Beam Size","text":"<p>Adjust accuracy/speed tradeoff at query time:</p> <pre><code>from langchain_cockroachdb import CSPANNQueryOptions\n\n# Higher beam = more accurate, slower\nquery_options = CSPANNQueryOptions(beam_size=200)\n\n# Lower beam = faster, less accurate\nquery_options = CSPANNQueryOptions(beam_size=50)\n\n# Apply to search\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=10,\n    # TODO: Pass query_options when implemented\n)\n</code></pre> <p>Currently set via session: <pre><code>async with engine.engine.connect() as conn:\n    await conn.execute(text(\"SET vector_search_beam_size = 200\"))\n    # Run queries\n</code></pre></p> <p>Guidelines: - Default: 100 (good balance) - High accuracy: 200-500 - Low latency: 25-50 - Production: 100-200</p>"},{"location":"guides/vector-indexes/#index-management","title":"Index Management","text":""},{"location":"guides/vector-indexes/#drop-index","title":"Drop Index","text":"<pre><code>await vectorstore.adrop_vector_index()\n</code></pre> <p>Or by name: <pre><code>DROP INDEX index_name;\n</code></pre></p>"},{"location":"guides/vector-indexes/#check-index-status","title":"Check Index Status","text":"<pre><code>async with engine.engine.connect() as conn:\n    from sqlalchemy import text\n    result = await conn.execute(\n        text(\"\"\"\n            SELECT indexname, indexdef \n            FROM pg_indexes \n            WHERE tablename = 'documents'\n        \"\"\")\n    )\n    for row in result:\n        print(f\"Index: {row[0]}\")\n        print(f\"Definition: {row[1]}\")\n</code></pre>"},{"location":"guides/vector-indexes/#rebuild-index","title":"Rebuild Index","text":"<p>Indexes are maintained automatically, but if needed:</p> <pre><code># Drop and recreate\nawait vectorstore.adrop_vector_index()\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n</code></pre>"},{"location":"guides/vector-indexes/#performance-comparison","title":"Performance Comparison","text":""},{"location":"guides/vector-indexes/#small-dataset-1000-vectors","title":"Small Dataset (1,000 vectors)","text":"Configuration Query Latency Notes No index 4-5ms Fast enough, index not needed With index 5-10ms Index overhead &gt; benefit <p>Recommendation: Skip index for &lt; 10K vectors</p>"},{"location":"guides/vector-indexes/#medium-dataset-50000-vectors","title":"Medium Dataset (50,000 vectors)","text":"Configuration Query Latency Notes No index 50-200ms Sequential scan slow With index 10-30ms 5-10x faster Index + beam=50 5-15ms Fast but less accurate Index + beam=200 15-40ms More accurate <p>Recommendation: Create index, tune beam size for workload</p>"},{"location":"guides/vector-indexes/#large-dataset-1m-vectors","title":"Large Dataset (1M+ vectors)","text":"Configuration Query Latency Notes No index 5-30s Unusable With index 20-100ms Essential Index + partitions 10-50ms Tuned partitions help <p>Recommendation: Always use index, tune partitions and beam</p>"},{"location":"guides/vector-indexes/#index-opclasses","title":"Index Opclasses","text":"<p>CockroachDB automatically chooses the correct opclass based on distance strategy:</p> Distance Strategy Opclass Operator COSINE <code>vector_cosine_ops</code> <code>&lt;=&gt;</code> EUCLIDEAN (L2) <code>vector_l2_ops</code> <code>&lt;-&gt;</code> INNER_PRODUCT <code>vector_ip_ops</code> <code>&lt;#&gt;</code>"},{"location":"guides/vector-indexes/#best-practices","title":"Best Practices","text":""},{"location":"guides/vector-indexes/#1-create-index-after-bulk-insert","title":"1. Create Index After Bulk Insert","text":"<pre><code># Insert data first\nawait vectorstore.aadd_texts(large_list_of_texts)\n\n# Then create index\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n</code></pre> <p>Building index on existing data is faster than incremental updates.</p>"},{"location":"guides/vector-indexes/#2-use-prefix-columns-for-multi-tenancy","title":"2. Use Prefix Columns for Multi-Tenancy","text":"<pre><code># Structure table with tenant_id first\n# Then create index - it will use prefix automatically\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n\n# Queries with tenant filter will be fast\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=10,\n    filter={\"tenant_id\": \"tenant-123\"}  # Uses index prefix\n)\n</code></pre>"},{"location":"guides/vector-indexes/#3-monitor-and-tune-beam-size","title":"3. Monitor and Tune Beam Size","text":"<pre><code># Start with default (100)\n# Monitor query latency\n# If too slow: reduce beam (50-75)\n# If accuracy issues: increase beam (150-200)\n</code></pre>"},{"location":"guides/vector-indexes/#4-consider-workload-balance","title":"4. Consider Workload Balance","text":"Workload Strategy Read-heavy Create index immediately Write-heavy Delay index creation Balanced Create index, monitor performance"},{"location":"guides/vector-indexes/#5-index-before-production","title":"5. Index Before Production","text":"<pre><code># Development: test without index first\n# Staging: create index, benchmark\n# Production: deploy with index\n</code></pre>"},{"location":"guides/vector-indexes/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/vector-indexes/#index-not-being-used","title":"Index Not Being Used","text":"<p>Check query plan: <pre><code>EXPLAIN SELECT * FROM documents \nORDER BY embedding &lt;=&gt; '[...]' LIMIT 10;\n</code></pre></p> <p>If index not used: - Check distance operator matches index opclass - Verify table statistics are up to date - Ensure CockroachDB version supports vector indexes (23.1+)</p>"},{"location":"guides/vector-indexes/#slow-index-creation","title":"Slow Index Creation","text":"<p>Large datasets take time: <pre><code>import time\n\nstart = time.time()\nawait vectorstore.aapply_vector_index(index)\nelapsed = time.time() - start\nprint(f\"Index created in {elapsed:.1f}s\")\n</code></pre></p> <p>Typical times: - 10K vectors: 1-5s - 100K vectors: 10-30s - 1M vectors: 1-5 minutes</p>"},{"location":"guides/vector-indexes/#accuracy-issues","title":"Accuracy Issues","text":"<p>Increase beam size: <pre><code>SET vector_search_beam_size = 200;\n</code></pre></p> <p>Or adjust partition sizes: <pre><code>index = CSPANNIndex(\n    min_partition_size=5,   # Smaller = more accurate\n    max_partition_size=50,  # Smaller = more accurate\n)\n</code></pre></p>"},{"location":"guides/vector-indexes/#next-steps","title":"Next Steps","text":"<ul> <li>Hybrid Search - Combine indexes with FTS</li> <li>Configuration - Optimize for your workload</li> <li>API Reference - Full index API</li> </ul>"},{"location":"guides/vector-store/","title":"Vector Store Guide","text":"<p>Complete guide to using the CockroachDB vector store.</p>"},{"location":"guides/vector-store/#overview","title":"Overview","text":"<p>The <code>AsyncCockroachDBVectorStore</code> provides a high-performance interface for storing and searching vector embeddings in CockroachDB.</p>"},{"location":"guides/vector-store/#basic-usage","title":"Basic Usage","text":""},{"location":"guides/vector-store/#initialization","title":"Initialization","text":"<pre><code>from langchain_cockroachdb import AsyncCockroachDBVectorStore, CockroachDBEngine\nfrom langchain_openai import OpenAIEmbeddings\n\n# Create engine\nengine = CockroachDBEngine.from_connection_string(\n    \"cockroachdb://user:pass@host:26257/db\"\n)\n\n# Initialize table\nawait engine.ainit_vectorstore_table(\n    table_name=\"documents\",\n    vector_dimension=1536,\n)\n\n# Create vector store\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=OpenAIEmbeddings(),\n    collection_name=\"documents\",\n)\n</code></pre>"},{"location":"guides/vector-store/#adding-documents","title":"Adding Documents","text":""},{"location":"guides/vector-store/#from-text","title":"From Text","text":"<pre><code># Simple text\ntexts = [\n    \"CockroachDB is a distributed database\",\n    \"LangChain simplifies LLM applications\",\n]\nids = await vectorstore.aadd_texts(texts)\nprint(f\"Added {len(ids)} documents\")\n</code></pre>"},{"location":"guides/vector-store/#with-metadata","title":"With Metadata","text":"<pre><code>texts = [\"Doc 1\", \"Doc 2\", \"Doc 3\"]\nmetadatas = [\n    {\"source\": \"web\", \"category\": \"tech\", \"year\": 2024},\n    {\"source\": \"pdf\", \"category\": \"science\", \"year\": 2023},\n    {\"source\": \"api\", \"category\": \"tech\", \"year\": 2024},\n]\n\nids = await vectorstore.aadd_texts(texts, metadatas=metadatas)\n</code></pre>"},{"location":"guides/vector-store/#from-documents","title":"From Documents","text":"<pre><code>from langchain_core.documents import Document\n\ndocuments = [\n    Document(\n        page_content=\"Content here\",\n        metadata={\"source\": \"file.txt\", \"page\": 1}\n    ),\n    Document(\n        page_content=\"More content\",\n        metadata={\"source\": \"file.txt\", \"page\": 2}\n    ),\n]\n\nids = await vectorstore.aadd_documents(documents)\n</code></pre>"},{"location":"guides/vector-store/#with-custom-ids","title":"With Custom IDs","text":"<pre><code>import uuid\n\ncustom_ids = [str(uuid.uuid4()) for _ in range(len(texts))]\nids = await vectorstore.aadd_texts(texts, ids=custom_ids)\n</code></pre>"},{"location":"guides/vector-store/#batch-size-control","title":"Batch Size Control","text":"<pre><code># Override default batch size at runtime\nids = await vectorstore.aadd_texts(\n    large_text_list,\n    batch_size=500  # Larger batches for throughput\n)\n</code></pre>"},{"location":"guides/vector-store/#searching","title":"Searching","text":""},{"location":"guides/vector-store/#similarity-search","title":"Similarity Search","text":"<pre><code># Basic search\nresults = await vectorstore.asimilarity_search(\n    \"distributed databases\",\n    k=5\n)\n\nfor doc in results:\n    print(f\"Content: {doc.page_content}\")\n    print(f\"Metadata: {doc.metadata}\")\n</code></pre>"},{"location":"guides/vector-store/#with-scores","title":"With Scores","text":"<pre><code>results = await vectorstore.asimilarity_search_with_score(\n    \"distributed databases\",\n    k=5\n)\n\nfor doc, score in results:\n    print(f\"Score: {score:.4f}\")\n    print(f\"Content: {doc.page_content}\")\n</code></pre>"},{"location":"guides/vector-store/#by-vector","title":"By Vector","text":"<pre><code># Search with your own vector\nembedding = embeddings.embed_query(\"my query\")\nresults = await vectorstore.asimilarity_search_by_vector(\n    embedding,\n    k=5\n)\n</code></pre>"},{"location":"guides/vector-store/#with-relevance-scores","title":"With Relevance Scores","text":"<pre><code>results = await vectorstore.asimilarity_search_with_relevance_scores(\n    \"query\",\n    k=5,\n    score_threshold=0.7  # Only return scores above threshold\n)\n</code></pre>"},{"location":"guides/vector-store/#filtering","title":"Filtering","text":""},{"location":"guides/vector-store/#basic-filters","title":"Basic Filters","text":"<pre><code># Equality\nresults = await vectorstore.asimilarity_search(\n    \"tech content\",\n    k=5,\n    filter={\"category\": \"tech\"}\n)\n\n# Multiple conditions (implicit AND)\nresults = await vectorstore.asimilarity_search(\n    \"recent tech\",\n    k=5,\n    filter={\"category\": \"tech\", \"year\": 2024}\n)\n</code></pre>"},{"location":"guides/vector-store/#advanced-filters","title":"Advanced Filters","text":""},{"location":"guides/vector-store/#comparison-operators","title":"Comparison Operators","text":"<pre><code># Greater than\nfilter={\"year\": {\"$gt\": 2020}}\n\n# Greater than or equal\nfilter={\"year\": {\"$gte\": 2020}}\n\n# Less than\nfilter={\"score\": {\"$lt\": 0.9}}\n\n# Less than or equal\nfilter={\"score\": {\"$lte\": 0.9}}\n\n# Not equal\nfilter={\"status\": {\"$ne\": \"archived\"}}\n</code></pre>"},{"location":"guides/vector-store/#in-and-not-in","title":"IN and NOT IN","text":"<pre><code># IN operator\nfilter={\"category\": {\"$in\": [\"tech\", \"science\", \"engineering\"]}}\n\n# NOT IN operator\nfilter={\"status\": {\"$nin\": [\"draft\", \"archived\"]}}\n</code></pre>"},{"location":"guides/vector-store/#logical-operators","title":"Logical Operators","text":"<pre><code># AND (explicit)\nfilter={\n    \"$and\": [\n        {\"category\": \"tech\"},\n        {\"year\": {\"$gte\": 2023}}\n    ]\n}\n\n# OR\nfilter={\n    \"$or\": [\n        {\"category\": \"tech\"},\n        {\"category\": \"science\"}\n    ]\n}\n\n# Complex nested\nfilter={\n    \"$and\": [\n        {\"year\": {\"$gte\": 2023}},\n        {\n            \"$or\": [\n                {\"category\": \"tech\"},\n                {\"category\": \"science\"}\n            ]\n        }\n    ]\n}\n</code></pre>"},{"location":"guides/vector-store/#filter-examples","title":"Filter Examples","text":"<pre><code># Recent tech or science documents\nresults = await vectorstore.asimilarity_search(\n    \"innovation\",\n    k=10,\n    filter={\n        \"$and\": [\n            {\"year\": {\"$gte\": 2023}},\n            {\"category\": {\"$in\": [\"tech\", \"science\"]}}\n        ]\n    }\n)\n\n# High-quality documents from specific sources\nresults = await vectorstore.asimilarity_search(\n    \"research\",\n    k=10,\n    filter={\n        \"$and\": [\n            {\"source\": {\"$in\": [\"arxiv\", \"nature\", \"ieee\"]}},\n            {\"quality_score\": {\"$gte\": 0.8}}\n        ]\n    }\n)\n</code></pre>"},{"location":"guides/vector-store/#updating-and-deleting","title":"Updating and Deleting","text":""},{"location":"guides/vector-store/#update-documents","title":"Update Documents","text":"<pre><code># Re-add with same ID to update\nawait vectorstore.aadd_texts(\n    [\"Updated content\"],\n    ids=[\"existing-id\"]\n)\n</code></pre>"},{"location":"guides/vector-store/#delete-by-ids","title":"Delete by IDs","text":"<pre><code>ids_to_delete = [\"id1\", \"id2\", \"id3\"]\nawait vectorstore.adelete(ids=ids_to_delete)\n</code></pre>"},{"location":"guides/vector-store/#delete-all","title":"Delete All","text":"<pre><code># Delete all documents in collection\nawait vectorstore.adelete()\n</code></pre>"},{"location":"guides/vector-store/#retriever-interface","title":"Retriever Interface","text":""},{"location":"guides/vector-store/#as-retriever","title":"As Retriever","text":"<pre><code># Convert to LangChain retriever\nretriever = vectorstore.as_retriever(\n    search_type=\"similarity\",\n    search_kwargs={\"k\": 5}\n)\n\n# Use in chains\nfrom langchain.chains import RetrievalQA\nfrom langchain_openai import ChatOpenAI\n\nqa = RetrievalQA.from_chain_type(\n    llm=ChatOpenAI(),\n    chain_type=\"stuff\",\n    retriever=retriever,\n)\n\nanswer = await qa.ainvoke(\"What is CockroachDB?\")\n</code></pre>"},{"location":"guides/vector-store/#mmr-maximal-marginal-relevance","title":"MMR (Maximal Marginal Relevance)","text":"<pre><code># Diverse results (less similar to each other)\nretriever = vectorstore.as_retriever(\n    search_type=\"mmr\",\n    search_kwargs={\n        \"k\": 10,\n        \"fetch_k\": 50,  # Fetch more candidates\n        \"lambda_mult\": 0.5  # Balance relevance vs diversity\n    }\n)\n\n# Or directly\nresults = await vectorstore.amax_marginal_relevance_search(\n    \"query\",\n    k=10,\n    fetch_k=50,\n    lambda_mult=0.5\n)\n</code></pre>"},{"location":"guides/vector-store/#similarity-score-threshold","title":"Similarity Score Threshold","text":"<pre><code># Only return highly relevant results\nretriever = vectorstore.as_retriever(\n    search_type=\"similarity_score_threshold\",\n    search_kwargs={\n        \"k\": 10,\n        \"score_threshold\": 0.8\n    }\n)\n</code></pre>"},{"location":"guides/vector-store/#distance-strategies","title":"Distance Strategies","text":"<p>Choose distance metric based on your embeddings:</p> <pre><code>from langchain_cockroachdb import DistanceStrategy\n\n# Cosine similarity (default, normalized vectors)\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    distance_strategy=DistanceStrategy.COSINE\n)\n\n# Euclidean distance (L2)\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    distance_strategy=DistanceStrategy.EUCLIDEAN\n)\n\n# Inner product\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    distance_strategy=DistanceStrategy.INNER_PRODUCT\n)\n</code></pre>"},{"location":"guides/vector-store/#which-to-use","title":"Which to Use?","text":"Distance Strategy Best For Normalized? Cosine Most embeddings (OpenAI, Anthropic) Yes Euclidean (L2) Spatial data, distances matter No Inner Product Pre-normalized vectors, speed priority Yes"},{"location":"guides/vector-store/#table-management","title":"Table Management","text":""},{"location":"guides/vector-store/#drop-table","title":"Drop Table","text":"<pre><code>await vectorstore.adrop_table()\n</code></pre>"},{"location":"guides/vector-store/#check-if-table-exists","title":"Check if Table Exists","text":"<pre><code>async with engine.engine.connect() as conn:\n    from sqlalchemy import text\n    result = await conn.execute(\n        text(\"\"\"\n            SELECT EXISTS (\n                SELECT FROM information_schema.tables \n                WHERE table_name = 'documents'\n            )\n        \"\"\")\n    )\n    exists = result.scalar()\n</code></pre>"},{"location":"guides/vector-store/#performance-tips","title":"Performance Tips","text":""},{"location":"guides/vector-store/#1-use-appropriate-batch-sizes","title":"1. Use Appropriate Batch Sizes","text":"<pre><code># Smaller embeddings\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=500  # &lt; 512 dims\n)\n\n# Larger embeddings\nvectorstore = AsyncCockroachDBVectorStore(\n    engine=engine,\n    embeddings=embeddings,\n    collection_name=\"docs\",\n    batch_size=100  # &gt; 1024 dims\n)\n</code></pre>"},{"location":"guides/vector-store/#2-create-indexes","title":"2. Create Indexes","text":"<pre><code>from langchain_cockroachdb import CSPANNIndex\n\n# Create vector index for faster queries\nindex = CSPANNIndex()\nawait vectorstore.aapply_vector_index(index)\n</code></pre> <p>See Vector Indexes Guide for details.</p>"},{"location":"guides/vector-store/#3-use-connection-pooling","title":"3. Use Connection Pooling","text":"<pre><code>engine = CockroachDBEngine.from_connection_string(\n    connection_string,\n    pool_size=20,      # More connections for concurrency\n    max_overflow=40,\n)\n</code></pre>"},{"location":"guides/vector-store/#4-filter-early","title":"4. Filter Early","text":"<pre><code># Good: Filter reduces candidates before vector search\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=10,\n    filter={\"category\": \"tech\"}  # Narrows search space\n)\n\n# Less efficient: No filter means searching all vectors\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=10\n)\n# Then filter results in Python\n</code></pre>"},{"location":"guides/vector-store/#common-patterns","title":"Common Patterns","text":""},{"location":"guides/vector-store/#multi-tenant-isolation","title":"Multi-Tenant Isolation","text":"<pre><code># Store tenant_id in metadata\nawait vectorstore.aadd_texts(\n    texts,\n    metadatas=[{\"tenant_id\": \"tenant-123\"}] * len(texts)\n)\n\n# Query with tenant filter\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=5,\n    filter={\"tenant_id\": \"tenant-123\"}\n)\n</code></pre>"},{"location":"guides/vector-store/#versioning-documents","title":"Versioning Documents","text":"<pre><code># Include version in metadata\nawait vectorstore.aadd_texts(\n    [\"Document content\"],\n    metadatas=[{\"doc_id\": \"abc123\", \"version\": 2}]\n)\n\n# Query latest version\nresults = await vectorstore.asimilarity_search(\n    \"query\",\n    k=5,\n    filter={\"version\": {\"$gte\": 2}}\n)\n</code></pre>"},{"location":"guides/vector-store/#source-attribution","title":"Source Attribution","text":"<pre><code># Track sources\nmetadatas = [\n    {\n        \"source\": \"https://example.com/page1\",\n        \"title\": \"Page Title\",\n        \"author\": \"John Doe\",\n        \"date\": \"2024-01-15\"\n    }\n]\n\nawait vectorstore.aadd_texts(texts, metadatas=metadatas)\n\n# Search and cite sources\nresults = await vectorstore.asimilarity_search_with_score(\n    \"query\", k=3\n)\n\nfor doc, score in results:\n    print(f\"Source: {doc.metadata['source']}\")\n    print(f\"Relevance: {score:.2f}\")\n</code></pre>"},{"location":"guides/vector-store/#error-handling","title":"Error Handling","text":"<pre><code>import asyncio\n\ntry:\n    results = await vectorstore.asimilarity_search(\"query\", k=5)\nexcept Exception as e:\n    print(f\"Search failed: {e}\")\n    # Retry logic is automatic, but you can catch final failure\n</code></pre>"},{"location":"guides/vector-store/#next-steps","title":"Next Steps","text":"<ul> <li>Vector Indexes - Optimize query performance</li> <li>Hybrid Search - Combine FTS with vectors</li> <li>Configuration - Tune for your workload</li> </ul>"}]}